
# Unexpected behavior with Batch Changes tokens <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#12128](https://sourcegraph.zendesk.com/agent/tickets/12128)
- Application engineer: Gabe Torres
- Customer: FactSet <!-- Redact if this contains personally identifying information -->
- Date: November 17, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 4.0.1​
- Deployment: docker-compose
- External Services: GITHUB,OTHER
- Auth Providers: github


## Links
<!-- Data for application engineer manual entry -->
- Slack Links:
- GitHub Issue Link:
- Doc Update Link:

## Summary
### Customer Question
FactSet is trialing Batch Changes and has been experiencing issues with clashing token permissions. In cases where the user's PAT has write access to certain repos but the instance's machine user token does not, Sourcegraph is not prioritizing the user's PAT. Instead, users get an error message saying that the change has partially failed because of permissions restrictions on the machine user token (even though their PAT has the requisite permissions).  

```
CreateCommitFromPatch"http://gitserver-0:3178/create-commit-from-patch": CreateCommitFromPatch: http status %!(string=500 Internal
Server Error), ("Rev".'''"'Error"("RepositoryName"."<name>"'"InternalError"."|u003credacted|u003eserver:
pushing ref: exit status 128" "Command"."|u003credacted|u003e -c credential.helper= -c protocol.version=2 push --force
lu003credacted|u003e@|u003credacted|u003e<name>.|u003credacted\u003e
5b2ed1f67c4359bbf9f23430c54540b19d326188:refs/heads/backstage-catalog-update","CombinedOutput":"ERROR: Permission to
<repo>.|u003credacted\u003e denied to <token>.Infatal: Could not read from remote repository. In\nPlease make sure you
have the correct access rights\nand the repository exists.ln"}}
```

### Application Engineer Answer
When the gitURLType is set to ssh, push ssh access to the code host has to be configured.  

These are the steps to get the key and add it to GitHub:  
https://docs.sourcegraph.com/batch_changes/how-tos/configuring_credentials#ssh-access-to-code-host  
https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account

### Relevant Docs Pages Used/Created

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 12128.md -->
