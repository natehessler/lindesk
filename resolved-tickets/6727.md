
# database migration issues with code insights <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#6727](https://sourcegraph.zendesk.com/agent/tickets/6727)
- Application engineer: Kelvin Lee
- Customer: Pandora Media, Inc. <!-- Redact if this contains personally identifying information -->
- Date: Mar 9

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ‚Äã3.34.2
- Deployment: pure-docker / nomad
- External Services: bibucketserver
- Auth Providers: builtin


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: [Slack](https://sourcegraph.slack.com/archives/C02QXK6PKMX/p1646850861948379) 
- GitHub Issue Link: None
- Doc Update Link: None

## Summary
### Description of Customer Issue
Seemed like they were having database migration issues, based on logs shared.

### Troubleshooting Steps
Just checked with the resolved tickets for keywords from the logs. But also, the logs seemed to make it pretty clear that there were database issues. Checked their version  using looker to make sure the [database migration docs](https://docs.sourcegraph.com/admin/how-to/dirty_database_pre_3_37 
) would be relevant. Just seems like the version needs to be before 3.37 to be relevant; customer was on 3.34.2 üëç 

### Resolution
None, sort of. Giselle ended up working with the customer in a [different thread/ticket](https://sourcegraph.slack.com/archives/C02QXK6PKMX/p1647028504817209) (a bit more specifically [here](https://sourcegraph.slack.com/archives/C02QXK6PKMX/p1647039208527859?thread_ts=1647028504.817209&cid=C02QXK6PKMX) , a thread in the pandora channel march 11th) , and they disabled the codeinsights db using `DISABLE_CODE_INSIGHTS: true `, which seems to be an environment variable... somewhere.

Since code insights got disabled, logs no longer surfaced regarding code insight migrations.

### Relevant Docs Pages Used/Created
https://docs.sourcegraph.com/admin/how-to/dirty_database_pre_3_37 

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->

```

t=2022-03-09T18:32:28+0000 lvl=info msg="opentracing: Jaeger disabled"
failed to initialize insights: Failed to perform codeinsights database migration: Failed to migrate the DB. Please contact support@sourcegraph.com for further assistance: Dirty database version 1000000001. Fix and force version.
t=2022-03-09T18:32:59+0000 lvl=info msg="opentracing: Jaeger disabled"
failed to initialize insights: Failed to perform codeinsights database migration: Failed to migrate the DB. Please contact support@sourcegraph.com for further assistance: Dirty database version 1000000001. Fix and force version.
```


<!--¬†Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets¬†as a .md file -->
<!-- Name the file 6727.md -->
