
# SAP - repo is not syncing <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#7836](https://sourcegraph.zendesk.com/agent/tickets/7836)
- Application engineer: Warren Gifford
- Customer: SAP - Americas <!-- Redact if this contains personally identifying information -->
- Date: Apr 25

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.35.1​
- Deployment: kubernetes
- External Services: GITHUB
- Auth Providers: builtin,github


## Links
<!-- Data for application engineer manual entry -->
- Slack Links:
- GitHub Issue Link:
- Doc Update Link:

## Summary
### Description of Customer Issue

A users repo stopped updating for around 5 days

### Troubleshooting Steps

Took a look at the gitserver and repo-updater logs, as well as grafana charts. Found gitserver memory was near full usage. Found some errors in logs for long requests.

t=2022-04-25T15:36:04+0000 lvl=warn msg="Long exec request" actor=1035 args="blame -w --porcelain 0f68fde6f37cf9af535572badec14c4b548efc1a -- ivy-versions.properties" client=frontend cmd=blame cmd_duration_ms=40132 duration_ms=40132 ensure_revision= ensure_revision_status=noop exit_status=0 fetch_duration_ms=0 repo=github.wdf.sap.corp/bizx/build-system status=0 stderr_size=0 stdout_size=467075

t=2022-04-25T15:49:10+0000 lvl=warn msg="Slow fetch/clone for exec request" actor=1035 args="rev-parse 4bc8345adce90e74aa3b4719fb47280e897d1a3b^0" client=frontend cmd=rev-parse cmd_duration_ms=0 duration_ms=59993 ensure_revision=4bc8345adce90e74aa3b4719fb47280e897d1a3b^0 ensure_revision_status=fetched error="context canceled" exit_status=-10810 fetch_duration_ms=59993 repo=github.wdf.sap.corp/bizx/build-system status=-10810 stderr_size=0 stdout_size=0


Constructed query to look at repo from database view -- tested locally
warrengifford@Warrens-MacBook-Pro SAP-logs % kns exec -it pgsql-8565fd54ff-6n8tk -- psql -U sg -c "SELECT A.repo_id, B.name, A.clone_status, A.updated_at, A.last_fetched, A.last_changed, A.last_error, A.repo_size_bytes FROM gitserver_repos A LEFT JOIN repo B ON A.repo_id = B.id WHERE B.name = 'github.com/sourcegraph/sourcegraph';"
Defaulted container "pgsql" out of: pgsql, pgsql-exporter, correct-data-dir-permissions (init)
 repo_id |                name                | clone_status |          updated_at           |         last_fetched          |         last_changed         | last_error | repo_size_bytes
---------+------------------------------------+--------------+-------------------------------+-------------------------------+------------------------------+------------+-----------------
  312816 | github.com/sourcegraph/sourcegraph | cloned       | 2022-04-25 20:21:31.391227+00 | 2022-04-25 20:21:30.788988+00 | 2022-04-25 20:21:31.36804+00 |            |      1222635727
(1 row)


### Resolution

This was resolved with a gitserver restart

### Relevant Docs Pages Used/Created

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 7836.md -->
