
# Migrator error <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#9800](https://sourcegraph.zendesk.com/agent/tickets/9800)
- Application engineer: Gabe Torres
- Customer: Wayfair <!-- Redact if this contains personally identifying information -->
- Date: July 18, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.36.1​
- Deployment: kubernetes
- External Services:
- Auth Providers:


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C024QE1K0FP/p1658174672165569
- GitHub Issue Link:
- Doc Update Link:

## Summary
### Description of Customer Issue
The instance is not coming up after an upgrade from 3.38.0 to 3.39.1.

### Troubleshooting Steps
Looked at logs for the frontend and migrator. The migrator logs showed that the migrator hadn't run.

### Resolution
The customer changed the startup command and missed the up argument for migrator, so the migrations didn't run after the upgrade.

### Relevant Docs Pages Used/Created

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->
`ERROR: failed to connect to frontend database: database schema out of date`

```
NAME:
   migrator - Validates and runs schema migrations

USAGE:
   migrator command [command options] [arguments...]

COMMANDS:
   up        Apply all migrations
   upto      Ensure a given migration has been applied - may apply dependency migrations
   downto    Revert any applied migrations that are children of the given targets - this effectively "resets" the schmea to the target version
   validate  Validate the current schema
   add-log   Add an entry to the migration log
   help, h   Shows a list of commands or help for one command

OPTIONS:
   --help, -h  show help (default: false)
```

```
t=2022-07-19T15:41:07+0000 lvl=info msg="Checked current schema state" schema=frontend appliedVersions=[] pendingVersions=[] failedVersions=[]
t=2022-07-19T15:41:07+0000 lvl=warn msg="Schema not in expected state" schema=frontend appliedVersions=[] pendingVersions=[] failedVersions=[] targetDefinitions="[1647849753 1647860082 1648051770 1648115472 1648195639 1648524019 1648628900 1649269601 1649441222 1649759318 1649432863]"
t=2022-07-19T15:41:07+0000 lvl=info msg="Checking for active migrations" schema=frontend
t=2022-07-19T15:41:07+0000 lvl=info msg="Acquired schema migration lock" schema=frontend
t=2022-07-19T15:41:07+0000 lvl=info msg="Checked current schema state" schema=frontend appliedVersions=[] pendingVersions=[] failedVersions=[]
t=2022-07-19T15:41:07+0000 lvl=info msg="Released schema migration lock" schema=frontend
ERROR: failed to connect to frontend database: database schema out of date
```


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 9800.md -->
