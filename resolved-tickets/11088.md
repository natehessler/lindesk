
# Admin Account Support <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#11088](https://sourcegraph.zendesk.com/agent/tickets/11088)
- Application engineer: Gabe Torres
- Customer: Sourcegraph <!-- Redact if this contains personally identifying information -->
- Date: September 16, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​
- Deployment:
- External Services:
- Auth Providers:


## Links
<!-- Data for application engineer manual entry -->
- Slack Links:
- GitHub Issue Link:
- Doc Update Link:

## Summary
### Customer Question
The user needs to create an account and become a site admin so that he can configure the instance. The admin, who did the deployment, is not able to log in.

### Application Engineer Answer
We can create a new user account and promote it to site admin by running a command in the database.

1. We need to edit the site config to enable new user sign-ups. We can do this by editing site-config.json in the frontend pods.
https://docs.sourcegraph.com/admin/config/site_config#sourcegraph-with-kubernetes 

The command to access the site-config.json file is kubectl exec -it $FRONTEND_POD -- sh -c 'vi ~/site-config.json'

You will need to change allowSignup to true, the site-config.json file should look like this after you edit it:

```
{
// The externally accessible URL for Sourcegraph (i.e., what you type into your browser)
// This is required to be configured for Sourcegraph to work correctly.
// "externalURL": "https://sourcegraph.example.com",
// The authentication provider to use for identifying and signing in users.
// Only one entry is supported.
//
// The builtin auth provider with signup disallowed (shown below) means that
// after the initial site admin signs in, all other users must be invited.
//
// Other providers are documented at https://docs.sourcegraph.com/admin/auth.
"auth.providers": [
{
"allowSignup": true,
"type": "builtin"
}
],
"search.index.enabled": true
} 
```

2. Create a new user account.

3. Exec into the database pod and change the new user to site admin.
This is the command to connect to the main database. kubectl exec -ti PGSQL-Container-Name -- psql -U sg
The name of the main Postgres database pod will be in the form of pgsql-RANDOM-ID
https://docs.sourcegraph.com/admin/how-to/run-psql#kubernetes

Once connected to psql, run select * from users; to get the id of the new user you created.

The command to promote the user to admin is update users set site_admin='t' where id='ID';

If the command runs successfully, you will see UPDATE 1, and the new user will be an admin.

### Relevant Docs Pages Used/Created

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 11088.md -->
