
# Gitserver and indexed-search consume alot more memory <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#11693](https://sourcegraph.zendesk.com/agent/tickets/11693)
- Application engineer: Michael Bali
- Customer: Booking.com <!-- Redact if this contains personally identifying information -->
- Date: October 14, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.37.0​
- Deployment: kubernetes
- External Services: GITLAB
- Auth Providers: gitlab


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C024D1ESXUH/p1665750599189559
- GitHub Issue Link: N/A
- Doc Update Link:

## Summary
### Description of Customer Issue
Sourcegraph seems to consume a lot more memory on both `gitserver` and `indexed-search` pods after the upgrade, I'm getting a lot of OOM kills with configurations that were fine before.

### Troubleshooting Steps
Looking at the zoekt logs there are no visible errors. I took one second look at the logs from the symbol pod and I can confirm the root cause for indexserver OOMing is indeed us OOMing on the monorepo. We have been working on improving monorepo indexing and increasing the memory was the right mitigation here while we work on improving this process.

### Resolution
Giving more memory to the `index server` stopped it from getting killed.

Are there any plans to maybe created separate zoekt indices for big mono repo to spread that out?  

We already do this. All repos are broken down into 100MB chunks of code. These chunks are not distributed amongst machines, we haven't found the need for that. We have implemented incremental indexing (to improve indexing time on large repos), but that is still in the testing phase.

### Relevant Docs Pages Used/Created

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 11693.md -->
