

# Batch Change operation failed when publishing a Changeset <!-- Ticket Title  Hint: include keywords to make it searchable -->



- Zendesk Link: [#4411](https://sourcegraph.zendesk.com/agent/tickets/4411)

- CSE: Michael Bali

- Customer: Indeed <!-- Redact if this contains personally identifying information -->

- Date: Nov 2, 2021


<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->

<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->



## Technical Environment

- Version: 3.31.2​

- Deployment: kubernetes

- External Services: GITLAB

- Auth Providers: saml





## Links
<!-- Data for CSE manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C01EDKVG9J5/p1635894938003700

- GitHub Issue Link: N/A

- Doc Update Link: N/A



## Summary

### Description of Customer Issue

The Customer is seeing an Authentication failure error when trying to publish a batch change.


### Troubleshooting Steps

- Creating, updating, or publishing a batch change; or publishing a single changeset: You must have access to view the repositories and the configured token must have the rights to push a branch and create the changesets on your code host (e.g., the repo scope gives a GitLab access token the rights to push to branches and open pull requests on GitLab repositories).

- Batch Changes requires the following scopes on GitLab:


- ```read_repository```
- ```write_repository```
- ```api```







### Resolution

The Customer recreated all the tokens but also updated the ```src-cli``` version to match the server, and that seems to work. it looks like the problem was the src-cli being out of date in conjunction with creating new tokens.


### Relevant Docs Pages Used/Created

https://docs.sourcegraph.com/batch_changes/how-tos/configuring_credentials#gitlab

### Relevant Error / Logs

<!-- Please redact keys, tokens, and personal identifying information -->

```
Creating commit from patch for repository "http://code.stage.xxxx.net/code-intelligence/xxxx-xxxx.stage.xx.net/code-intelligence/xxx>": gitserver: pushing ref: exit status 128$ git push --force https://git:&lt;redacted&gt;@code.stage.xxx.net/code-intelligence/xxxxx.git xxxxxxxxxx:refs/heads/jira/SOURCEGRPH-278
remote: HTTP Basic: Access denied
fatal: Authentication failed for 'https://code.stage.xxxxx.net/code-intelligence/xxxxx.git/
```


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 4411.md -->
