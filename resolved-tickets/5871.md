
# Refreshing a Repository before a Search <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#5871](https://sourcegraph.zendesk.com/agent/tickets/5871)
- Application engineer: Michael Bali
- Customer: Typeform <!-- Redact if this contains personally identifying information -->
- Date: Jan 27,2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​N/A
- Deployment: N/A
- External Services: N/A
- Auth Providers: N/A


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: N/A
- GitHub Issue Link: https://github.com/sourcegraph/customer/issues/686
- Doc Update Link: N/A

## Summary
### Description of Customer Issue
The customer is trying to search a new branch right after it gets created without getting to know the branch name. 


### Troubleshooting Steps
-  I initially thought search context would work in this case. However, their tool needs to be able to search right after the branch as been created even without knowing the branch name.
- I tried running a test to simulate your scenario.
First, I have this repo indexed on a self-hosted sourcegraph instance. I modified a file in GitHub and try to monitor how soon the changes appear on sourcegraph. It was almost immediately, some few seconds. Now I tried the same modification to a branch that already exists. I searched using the @branch in the query and I got the changes on sourcegraph after a few seconds. Furthermore, I created a new branch on GitHub. I checked for how soon a newly-created branch appeared on SG and it was instant, some few seconds after.
I just wanted to confirm that your code host is a self-managed GitHub Enterprise correct and if there are any git configurations I need to be aware of?
- Are the repos where the new branches are created indexed on your sourcegraph instance?
- can you find out how long it currently takes for updates on your code host to sync in sourcegraph. Trying to rule out the possibility of your instance being under-provisioned causing it to take a longer time to sync.
-  Notice any strange error in your repo-updater pod?
- Set up a zoom invite with the customer to understand their environment and get a clearer picture of things


### Resolution
If you want to ensure a specific branch exists in Sourcegraph you can call our API like this:
```
query{
  repository(name:"github.com/sourcegraph/sourcegraph"){
    commit(rev:"0bc34e70d69c063a6e2714a44e876dabe11ebc81"){
      subject
    }
  }
}
```
The subject is just there to force the query to run.
If you execute the above query with the latest commit SHA for your PR it will attempt to fetch the code if it doesn't exist and the query will only return once the new code has been fetched.

### Relevant Docs Pages Used/Created
N/A

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->
N/A

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 5871.md -->
