
# batch change search / on field / repositoriesMatchingQuery field / query intersection / combination of search terms <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#5862](https://sourcegraph.zendesk.com/agent/tickets/5862)
- Application engineer: Kelvin Lee
- Customer: Indeed <!-- Redact if this contains personally identifying information -->
- Date: Jan 27

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.33.2​
- Deployment: kubernetes
- External Services: GITLAB
- Auth Providers: saml


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: [Slack](https://sourcegraph.slack.com/archives/C01EDKVG9J5/p1643324770017800) , secondary internal ask for help [here](https://sourcegraph.slack.com/archives/C01JR51JR5J/p1643408309249359) 
- GitHub Issue Link: None
- Doc Update Link: None

## Summary
### Customer Question
Can one get the intersection of certain repo filters to work as a search query in batch changes?

### Application Engineer Answer
Yes! For a couple of reasons:

(1) Confidence that batch changes search syntax is powered by queries: https://docs.sourcegraph.com/batch_changes/references/troubleshooting
Quoted below:
> You can do so by changing the on.repositoriesMatchingQuery to yield less results or by using a concrete list of repositories with on.repository.
> For the former [on.repositoriesMatchingQuery] you can use Sourcegraph’s search filters.


(2) search syntax allows intersection/ boolean operators/ `AND`'ing things together: https://docs.sourcegraph.com/code_search/reference/queries#boolean-operators 

Example: `repo:contains.file(A.txt) AND repo:contains.file(B.md)`

Tested using src batch preview on my own machine, connecting to cse-k8s.sgdev.org in the src cli.


Customer followed up with questions about:
(a) `src batch preview` cleanup (if using a KILLSIGNAL/SIGKILL/command-C/interrupt/etc.)
(b) why `src batch preview` and `src search` and UI search might return different numbers of matches.

(A) No, we don't have any built in src commands that clean up the docker containers after a SIGKILL, unfortunately.
(B) `src batch preview` might be using the GraphQL endpoint, whereas as `src search` and UI search might use a streaming endpoint. The GraphQL endpoint is exhaustive, whereas the streaming one can sometimes omit results. In general, I believe we should expect that: # of result returned by GraphQL endpoint >= # of results returned by streaming endpoint. This is described in the secondary thread, by Warren, specifically [here](https://sourcegraph.slack.com/archives/C01JR51JR5J/p1643414120863229?thread_ts=1643408309.249359&cid=C01JR51JR5J) .

### Relevant Docs Pages Used/Created
https://docs.sourcegraph.com/batch_changes/references/troubleshooting
https://docs.sourcegraph.com/code_search/reference/queries#boolean-operators


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 5862.md -->
