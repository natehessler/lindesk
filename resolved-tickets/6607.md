
# DB is restarting due to connection problems <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#6607](https://sourcegraph.zendesk.com/agent/tickets/6607)
- Application engineer: Michael Bali
- Customer: Booking.com <!-- Redact if this contains personally identifying information -->
- Date: Mar 2

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.37.0​
- Deployment: kubernetes
- External Services: GITLAB
- Auth Providers: gitlab


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C024D1ESXUH/p1646298509920119
- GitHub Issue Link: N/A
- Doc Update Link: N/A

## Summary
### Description of Customer Issue
The Customers DB is getting restarted due to connection problems.

### Troubleshooting Steps
- Checked our doc, and tried to understand the meaning of max connection and I figured the max connection can be calculated by the number of replicas * 30.

### Resolution
I believe this can be resolved by increasing the max_connections value in your postgresql.conf or pgsql.ConfigMap.yaml.It may be necessary to raise your work_mem as well as more concurrent connections require more memory to process as stated in our doc
### Relevant Docs Pages Used/Created
- https://docs.sourcegraph.com/admin/config/postgres-conf

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->
```error: FATAL: sorry to many clients already ```


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 6607.md -->
