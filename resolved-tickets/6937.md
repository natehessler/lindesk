
# Repo stuck in starting clone <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#6937](https://sourcegraph.zendesk.com/agent/tickets/6937)
- Application engineer: Gabe Torres
- Customer: SAP - Americas <!-- Redact if this contains personally identifying information -->
- Date: Mar 16

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.35.1​
- Deployment: kubernetes
- External Services: GITHUB
- Auth Providers: builtin,github


## Links
<!-- Data for application engineer manual entry -->
- Slack Links:
- GitHub Issue Link:
- Doc Update Link:

## Summary
### Description of Customer Issue
The customer saw some repos stuck with the message 'Cloning in progress, starting clone".

### Troubleshooting Steps
Looked at logs for repo-updater and gitserver.  
Found this error in repo-updater:  
`t=2022-03-16T16:23:43+0000 lvl=eror msg="Failed to sync permissions" type=1 id=706 err="list repositories: failed to connect to `host=pgsql user=sg database=sg`: server error (FATAL: the database system is in recovery mode (SQLSTATE 57P03))"
t=2022-03-16T18:01:51+0000 lvl=warn msg="GitHub repository not found" error="{Message:Could not resolve to a Repository with the name 'repo-name'. Type:NOT_FOUND Path:[repo9] Locations:[{Line:26 Column:1}]}"`
Saw that the database was underprovisioned and bumped up the memory.  
Got a new set of gitserver/repo-updater logs and saw a lot of latency errors.   
`t=2022-03-21T06:38:15+0000 lvl=warn msg="GitHub repository not found" error="{Message:Could not resolve to a Repository with the name 'repo-name'. Type:NOT_FOUND Path:[repo9] Locations:[{Line:26 Column:1}]}"`

`t=2022-03-21T15:20:32+0000 lvl=eror msg="Failed to fetch" repo=repo error="failed to update with output \"fatal: unable to access 'repo': Failed to connect to github port 443 after 130821 ms: Operation timed out\\n\": exit status 128"` 
`t=2022-03-21T14:50:32+0000 lvl=eror msg="handleGetObject: getting object" error="git command [git rev-parse hash^{tree}] failed (output: \"\"): signal: killed"`

### Resolution
Gitserver seemed to be having network issues and was using 95% memory. I suggested bumping up resources but a restart of gitserver cleared the issue. It seems like the database failure caused some cleanup jobs to be stuck in failing loops.


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 6937.md -->
