
# Yelp: RCE issue with GitHub Enterprise removals on single docker <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#11710](https://sourcegraph.zendesk.com/agent/tickets/11710)
- Application engineer: Michael Bali
- Customer: Yelp Inc. <!-- Redact if this contains personally identifying information -->
- Date: October 14, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.23.0​
- Deployment: docker-container
- External Services: GITHUB
- Auth Providers: openidconnect


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/CFNURMWHE/p1665808477605419
- GitHub Issue Link: https://github.com/sourcegraph/customer/issues/1487, https://github.com/sourcegraph/customer/issues/1464
- Doc Update Link:   https://github.com/sourcegraph/sourcegraph/pull/44896

## Summary
### Customer Question
Yelp had two issues:
- The Repo Updater crashes their single docker container instance when trying to delete an external config.
- A missing Repo

### Troubleshooting Steps
- The| |panic we're seeing in the log is happening because an external service sync operation is finding a conflicting repo that already exists in the database.
- We are able to confirm that despite their instance being stable their Database is not in an healthy state. Every Repo in the Database should have a unique combination of the following field `"repo_external_unique_idx" UNIQUE, btree (external_service_type, external_service_id, external_id)` . However, this is not the case for Yelp as we are seeing repos having the same external IDs which isnt meant to be. This is caused by constraints being ignored.
- We also noticed a bug where the repo count for a particular GitHub org is slightly different from what we see in the code host.
- We ran a query against the github API to determine the repo count the token is getting and we see that the token is getting the right number.

### Resolution
- We were able to rebuild their Database indexes and get the DB to a healthy state.
- The issue with the missing repo is now fixed. This appears to be a bug that was resolved after Yelp upgraded their Github Enterprise instance.

### Relevant Docs Pages Used/Created

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 11710.md -->
