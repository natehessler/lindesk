
# twitter-upgrade-3.37.0-fail <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#6425](https://sourcegraph.zendesk.com/agent/tickets/6425)
- Application engineer: Warren Gifford
- Customer: Twitter <!-- Redact if this contains personally identifying information -->
- Date: Feb 22

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.36.3​
- Deployment: kubernetes
- External Services:
- Auth Providers:


## Links
<!-- Data for application engineer manual entry -->
- Slack Links:
- GitHub Issue Link:
- Doc Update Link:

## Summary
### Description of Customer Issue

Twittters upgrade to v3.37.0 failed

### Troubleshooting Steps

Inspect the init container logs for frontend with kubectl logs ... -c migrator look at manifest

### Resolution

After looking at the container logs correctly we discovered that the frontend was crashlooping because the migratory service was attempting to connect to codeinsight-db and failing to connect -- this is because the image had been tagged incorrectly in Twitters custom image registry 

### Relevant Docs Pages Used/Created

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->

Warning  FailedCreate  40s (x6 over 119s)  replicaset-controller  (combined from similar events): Error creating: pods "sourcegraph-frontend-staging-697b56c9b7-jn5vw" is forbidden: failed quota: preemptible-compute-resources: must specify limits.cpu,limits.memory


Init Containers:
  migrator:
    Container ID:  containerd://7393fa940b86916f1fe3b5b056fb77b5df681a6a2fa7108f485c6ed8c1516d8d
    Image:         gcr.io/twttr-compute-images-prod/sourcegraph-gke/migrator:3.37.0
    Image ID:      gcr.io/twttr-compute-images-prod/sourcegraph-gke/migrator@sha256:a18bf12a0795a43f0adffd811f0d554ef96ccfa30d509498b40d01bc0f182f58
    Port:          <none>
    Host Port:     <none>
    Args:
      up
    State:          Waiting
      Reason:       CrashLoopBackOff
    Last State:     Terminated
      Reason:       Error
      Exit Code:    1
      Started:      Wed, 23 Feb 2022 09:28:45 -0600
      Finished:     Wed, 23 Feb 2022 09:29:45 -0600


kubectl -n sourcegraph-gke-staging logs sourcegraph-frontend-staging-57c94bfc57-z4fs6 -c migrator
error: DB not available: timeout: dial tcp 10.238.144.47:5432: i/o timeout


codeinsights-db-staging-5c7644d488-qrjc9             0/1     ImagePullBackOff        0                6h22m



<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 6425.md -->
