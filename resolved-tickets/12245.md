
# Maximum connections exceeded in the codeinsights database <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#12245](https://sourcegraph.zendesk.com/agent/tickets/12245)
- Application engineer: Michael Bali
- Customer: MercadoLibre <!-- Redact if this contains personally identifying information -->
- Date: December 5, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.29.1​
- Deployment: docker-compose
- External Services: GITHUB
- Auth Providers:


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C021PRG65DH/p1670254925430279
- GitHub Issue Link: N/A
- Doc Update Link: N/A

## Summary
### Description of Customer Issue
Recently a user reported an error when generating a codeinsights and reviewing the message that was generated I realized that it was due to too many connections to the database. In this moment the database is internal and only allows a maximum of 20 connections, of which 2 are used by default and the other 18 for the generation of graphs, analyzing with the user that generated the error, each graph consumed from 1 to 2 connections. We need to increase this restriction to more than 20 connections, since with more than 2 or 3 users, insights is stopping us from working for exceeding this limit. How could we increase the maximum connections in the codeinsights db that is in postgresql?

### Troubleshooting Steps
- This error means that the max connections in the postgres config needs to be increased
-  Found out how many replicas are connected to the codeinsight DB.

### Resolution
The error means the database is getting too many connection requests from services like frontend , worker etc and it's not able to keep up as that's beyond the set default value.Hence, max connections needs to be increased to accomodate more active connection.To calculate the limit, How many replicas of your frontend and worker do you have? 
You multiply by 30 the number of replicas of the services that connect to the codeinsight DB

### Relevant Docs Pages Used/Created
https://docs.sourcegraph.com/admin/config/postgres-conf#max-connections
### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 12245.md -->
