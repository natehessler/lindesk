

# New Slack message in trial-toast-sourcegraph <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#6066](https://sourcegraph.zendesk.com/agent/tickets/6066)
- Application engineer: Giselle Northy
- Customer: Toast <!-- Redact if this contains personally identifying information -->
- Date: Feb 7

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.30.0​
- Deployment: docker-container
- External Services: GITHUB
- Auth Providers: builtin,github


## Links
<!-- Data for application engineer manual entry -->
- Slack Links:
- GitHub Issue Link:
- Doc Update Link:

## Summary
### Customer Question

We're trying to update from 3.30 -> 3.31, and reading over the instructions for that upgrade, I'm not sure what to do. Specifically this bit:
> If your indexes are corrupted, then there is also a possibility that there is bad data in your databases that would cause the re-indexing process (and thus the 3.31.x upgrade) to fail. In order to do a first-pass check for corrupt indexes, please run the following SQL query against both of the following instances before upgrading to 3.31.x:

The queries pointed only to docker-compose. He needed the query for single.

### Application Engineer Answer

THESE QUERIES ARE FOR SINGLE DOCKER CONTAINER

I confirmed that you’ll want to run the check script before upgrading on both the sourcegraph and sourcegraph-codeinteldbs.
Those are the equivalent to these in the docs - their name is a little different:
 

pgsql
codeintel-db

To get there I got the container  image id from docker ps
Then put in the container ID. Run the aforementioned queries for each DB and check the output.
 

`docker exec -it containerIDHERE psql --username=postgres sourcegraph`
`docker exec -it containerIDHERE psql --username=postgres sourcegraph-codeintel`


### Relevant Docs Pages Used/Created

DOC UPDATE HERE https://github.com/sourcegraph/sourcegraph/pull/30921

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 6066.md -->
