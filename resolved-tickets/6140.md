
# query consturction for code insights (negation / negative / exclusion) <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#6140](https://sourcegraph.zendesk.com/agent/tickets/6140)
- Application engineer: Kelvin Lee
- Customer: Reddit <!-- Redact if this contains personally identifying information -->
- Date: Feb 9

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.36.2​
- Deployment: kubernetes
- External Services: GITHUB
- Auth Providers: builtin,github


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: [Slack](https://sourcegraph.slack.com/archives/C02BJ8T258D/p1644435032025749)
- GitHub Issue Link: Not specific to this thread, but there are a couple that are shared below that mention some limitations of our code insight creation UI so far
- Doc Update Link: None

## Summary

<img width="1038" alt="Screen Shot 2022-02-16 at 5 25 01 PM" src="https://user-images.githubusercontent.com/7654435/154386367-aff0a2df-8654-4a0a-911b-022e42dfc367.png">

### Customer Question
Customer is unable to get negations working in the code insights (specifically, the "Create new insight" > "Detect and track patterns" sub-feature of code insights). 

### Application Engineer Answer
Negation is actually specifically blocked for "Detect and track patterns" code insights, as it's currently a technical gap (but not an uncrossable one). A [GitHub issue](https://github.com/sourcegraph/sourcegraph/issues/30713) is addressing it. However, "Track changes" code insights do still accept negations.

If, for some other reason, there are a lot of insights that the customer wants to construct, one can also try to do it via the [API](https://docs.sourcegraph.com/api/graphql/managing-code-insights-with-api#creating-a-persisted-insight) . Joel's wording on this:

> If you have very many individual patterns you’d like to track, you could also consider programmatically creating an insight with many series via our API.

### Relevant Docs Pages Used/Created

Some issues that Joel had shared:
https://github.com/sourcegraph/sourcegraph/issues/30713
https://github.com/sourcegraph/sourcegraph/issues/31028

Documentation on an API approach for creating an insight:
https://docs.sourcegraph.com/api/graphql/managing-code-insights-with-api#creating-a-persisted-insight

Evidence that negation is specifically flagged for: https://sourcegraph.com/github.com/sourcegraph/sourcegraph/-/blob/enterprise/internal/compute/query.go?L71

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 6140.md -->
