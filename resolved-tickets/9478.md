
# New Slack message in support-curve-sourcegraph <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#9478](https://sourcegraph.zendesk.com/agent/tickets/9478)
- Application engineer: Stomzy Mwendwa
- Customer: Curve <!-- Redact if this contains personally identifying information -->
- Date: July 3, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.31.2​
- Deployment: kubernetes
- External Services: GITLAB
- Auth Providers: builtin,saml


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C02EKVAHQPN/p1656922654909609 
- GitHub Issue Link: N/A
- Doc Update Link: N/A

## Summary
### Customer Question
Hey guys, we are using an S3 bucket for code intel and authenticating via access and secret key pair. Reading the doc I see PRECISE_CODE_INTEL_UPLOAD_AWS_USE_EC2_ROLE_CREDENTIALS. Can we use kube2iam by defining a role authorized to access the bucket and letting the kubernetes pod assume that role via “http://iam.amazonaws.com/roleiam.amazonaws.com/role>: my-role” kube2iam annotation?
### Application Engineer Answer
If i remember correctly, there was a feature request to auth S3 with kube2iam . Let me just pull that up for us.
Currently, I do know that we accept access token key pairs as environment variables.
I believe the solution with kube2iam is to redirect traffic going into the EC2 API for container-to-container on each instance, making a call to the AWS API to retrieve credentials then return this to the caller. Sort of like a messenger, or better yet, a man in the middle type of scenario.
Nonetheless, if an instance is configured for IAM, the SDK should use credentials automatically. These need not to be manually specified. :thinking_face:
So in real sense, this is "possible", it's just that Sourcegraph currently requires some configuration validation to access the secret keys.
Essentially, it is correct that there's a need to support IAM auth flows instead of explicitly relying on env vars.
PRECISE_CODE_INTEL_UPLOAD_AWS_USE_EC2_ROLE_CREDENTIALS=true
Happy to double check and confirm on this feature request. Be back soon.
### Relevant Docs Pages Used/Created

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 9478.md -->
