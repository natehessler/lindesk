
# renamed repo causing issues in batch changes <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#5654](https://sourcegraph.zendesk.com/agent/tickets/5654)
- Application engineer: Kelvin Lee
- Customer: Redfin <!-- Redact if this contains personally identifying information -->
- Date: Jan 18

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.35.1â€‹
- Deployment: docker-container
- External Services: BITBUCKETSERVER
- Auth Providers: builtin


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: [Slack with customer](https://sourcegraph.slack.com/archives/C01MRQQ9YQP/p1642551160001700), [Slack requesting help](https://sourcegraph.slack.com/archives/C01JR51JR5J/p1642622811150700), and a [in-the-future retro'ish look on this issue](https://sourcegraph.slack.com/archives/C01JR51JR5J/p1642795247301800?thread_ts=1642792459.299300&cid=C01JR51JR5J)
- GitHub Issue Link: [GitHub Issue](https://github.com/sourcegraph/customer/issues/652)
- Doc Update Link: None

## Summary
### Description of Customer Issue
Batch changes failing due to a renamed repo not behaving. (Keywords: rename, old repo, new repo, path changes, batch changes (but honestly effects any other part of the product that references the repo))

### Troubleshooting Steps
Attempted two known workarounds:
- Apply the `-clear-cache` flag, as described by some of our previously solved tickets [here'ish](https://github.com/sourcegraph/support-tools-internal/search?q=batch+changes+cache), specifically [1](https://github.com/sourcegraph/support-tools-internal/blob/2d768922f62c71700b75bc08e3ac5f6910a12a81/resolved-tickets/3917.md), [2](https://github.com/sourcegraph/support-tools-internal/blob/6c786e038d615aa861a590d6e4508b18e7c88e5d/resolved-tickets/5419.md), [3](https://github.com/sourcegraph/support-tools-internal/blob/3ec3243c4ec1b5fdfef7bd7898bb85c1e21a91a0/resolved-tickets/5385.md) 
- Exclusion list shenanigans, best described [here](https://sourcegraph.slack.com/archives/C01MRQQ9YQP/p1642635246005500?thread_ts=1642551160.001700&cid=C01MRQQ9YQP), but quoted here because I think not all Slack history is saved?:

> Here goes. The general idea is:
> I've fixed this in the past by adding the previous repo name to the code host exclusion list, waiting for it to be deleted, and then removing it from the exclusion list.Â (removing it again from the exclusion list isnt necessary, but it keeps the configuration cleaner)
>
> The steps to conduct the above look something like this:
> Please navigate toÂ Site Admin -> Manage Code Hosts -> (Select your code host)In the configuration JSON file, please add the following repo exclusion:
> 
```
"exclude": [
 Â Â Â {
 Â Â Â Â Â "name": "<name of troublesome repo>"
 Â Â Â }
 Â ],
```

> After a few minutes, Sourcegraph should remove the repo from your instance, and prevent it from being rediscovered which should resolve the issue.You can confirm this deletion is done by navigating to:
> Site Admin -> Repository StatusÂ and searching for the repository by name.If the repository does not appear, then it has been completely removed from your instance, and your batch change should resolve without error.
>
> This will require that you have site-admin access. Would you like to look this over and give it a shot? And of course, let me know if you have any questions or problems. I'll be working in parallel here to understand this as well.

Neither workaround worked ðŸ¤£ 

### Resolution
There's a code fix for it, [here](https://github.com/sourcegraph/zoekt/pull/244). I shared a specific commit to the customer, but it is captured in the PR linked.

### Relevant Docs Pages Used/Created

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->
```
Error:
  resolving repositories: resolving "context:global pipeline_template = 'libraryworkflow' file:pipeline_config.groovyÂ -file:\"{{ cookiecutter*\" -<REDACTED>  occurred:
 Â  * {
 Â Â "message": "repository does not exist: <REPO NAME>
 Â Â "path": [
 Â Â Â "search",
 Â Â Â "results",
 Â Â Â "results",
 Â Â Â 21,
 Â Â Â "repository",
 Â Â Â "defaultBranch"
 Â Â ]
 Â }

"repository does not exist"
```


<!--Â Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-ticketsÂ as a .md file -->
<!-- Name the file 5654.md -->
