

# GKE node upgrades stability <!-- Ticket Title  Hint: include keywords to make it searchable -->



- Zendesk Link: [#4435](https://sourcegraph.zendesk.com/agent/tickets/4435)

- Application engineer: Warren Gifford

- Customer: Twitter <!-- Redact if this contains personally identifying information -->

- Date: Nov 4


<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->

<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->



## Technical Environment

- Version: 3.33.0​

- Deployment: kubernetes

- External Services:

- Auth Providers:





## Links
<!-- Data for application engineer manual entry -->
- Slack Links: [https://sourcegraph.slack.com/archives/CTN0ZBETE/p1636052630031500](https://sourcegraph.slack.com/archives/CTN0ZBETE/p1636052630031500)
[https://sourcegraph.slack.com/archives/C02E4HE42BX/p1636056548123700](https://sourcegraph.slack.com/archives/C02E4HE42BX/p1636056548123700)

- GitHub Issue Link: [https://github.com/sourcegraph/sourcegraph/issues/28160](https://github.com/sourcegraph/sourcegraph/issues/28160)

- Doc Update Link: n/a



## Summary

### Description of Customer Issue
Twitter wants to know what happens to Sourcegraph during a node pool update (this is where the version of kubernetes running on nodes and the control plane is updated), we currently have no advisements here except that maybe the PVC will fail to reattach. 



### Troubleshooting Steps
I tested node updates to little avail on k8s-twit and cse-k8s. In most instances the frontend would temporarily go down, possibly dependent on the number of available nodes in the node pool. 



### Resolution
requested a doc be created on expected behavior here. 



### Relevant Docs Pages Used/Created

https://cloud.google.com/kubernetes-engine/docs/release-notes-stable
https://cloud.google.com/kubernetes-engine/upgrades#automatic_cp_upgrades
https://cloud.google.com/kubernetes-engine/docs/how-to/upgrading-a-cluster
https://docs.sourcegraph.com/admin/deployment_best_practices



### Relevant Error / Logs

Warning FailedAttachVolume 30m attachdetach-controller Multi-Attach error for volume "pvc-6603dcf4-77d4-424e-944a-cdc4ab19c5a5" Volume is already exclusively attached to one node and can't be attached to another

Note this was likely due to a configMap that no longer existed that gitserver was trying to reference




<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 4435.md -->
