
# Batch Spec fails to generate preview on a specific repository <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#7087](https://sourcegraph.zendesk.com/agent/tickets/7087)
- Application engineer: Michael Bali
- Customer: Booking.com <!-- Redact if this contains personally identifying information -->
- Date: Mar 22

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.37.0​
- Deployment: kubernetes
- External Services: GITLAB
- Auth Providers: gitlab


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C024D1ESXUH/p1648025851047139
- GitHub Issue Link: N/A
- Doc Update Link: N/A

## Summary
### Description of Customer Issue
The customer's batch specs keep failing by generating an empty preview on a specific repository.

### Troubleshooting Steps

- Can this user include the flag   `-keep-logs `in the preview command? This would look like this `src batch preview -f batch-spec.yaml -keep-logs` I would like to view the logs generated.
- is this main.git a monorepo?
- Have you set up webhooks?
- Are there file extensions in this repository with white space in its name? Currently, the Template Helper function doesn't recognize a file extension with space in its name.
- Considering that. the error thrown is no file or directory seen and since it works for other repos, I suspected the batch spec wasn't looping through the files in the repo. I suggested the use of a for loop in the batch spec.
- I ask that they try searching the files in the UI or src-cli.  If they can’t be found through the UI, then you should check gitserver by grepping one of the files. If it can’t be found on Gitserver, that means they truly don’t exist like that on Sourcegraph.
- Confirmed if the user has both read and write permissions in your org for this particular repo?  I want to understand what your permissions for this repo look like.
- Since the same spec works for Philip, I looked at the possibility of permission expiring
- I also asked the user to create a PAT and retry.
 
### Resolution
The User confirmed the spec worked on other dev machines except for his MacBook so there are some constraints locally preventing him from running the spec. It's not an issue with SG.

### Relevant Docs Pages Used/Created

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->
   ` Error: stat webxxxxxx/b-xxxxxxxx/xxx/xxxxx/xxxx.yaml: no such file or directory `

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 7087.md -->
