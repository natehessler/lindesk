
# Github Users Permission Scopes <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#11138](https://sourcegraph.zendesk.com/agent/tickets/11138)
- Application engineer: Michael Bali
- Customer: Emma-sleep <!-- Redact if this contains personally identifying information -->
- Date: September 20, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​
- Deployment:
- External Services:
- Auth Providers:


## Links
<!-- Data for application engineer manual entry -->
- Slack Links:
- GitHub Issue Link:
- Doc Update Link:

## Summary
### Customer Question

we are testing sourcegraph and we enabled Github oauth. We noticed after creating an account with Github that sourcegraph has full control of private repositories of the users. Why is that scope reqired and is it possible to change it?


### Application Engineer Answer

When users sign up for Sourcegraph with GitHub, the ideal scenario should be that they are presented with the GitHub page to grant access to Sourcegraph. This is then the user’s “login” and should provide no access beyond some Personal Identifiable Information like their email or username. When the same user then creates a code host connection, they should be presented with the same page, with expanded scopes to include public and private repository access. If the user is part of an organization, then that org's repos are also available to the user.

In addition, Sourcegraph syncs permissions in the background by default to better handle repository permissions at scale for [GitHub](https://docs.sourcegraph.com/admin/repo/permissions#github), [GitLab](https://docs.sourcegraph.com/admin/repo/permissions#gitlab), and [Bitbucket Server / Bitbucket Data Center](https://docs.sourcegraph.com/admin/repo/permissions#bitbucket-server) code hosts. Rather than syncing a user’s permissions when they log in and potentially blocking them from seeing search results, Sourcegraph syncs these permissions asynchronously in the background, opportunistically refreshing them in a timely manner.

We’ve found that we’re currently requesting repo scope when a user signs up with GitHub.  It would be ideal to request only personal information and not request the repo scope unless a specific user tag is present. However, for whatever reason, we’re requesting repo access from everyone.

What I think is a step in the right direction is how my teammates are focusing on introducing GitHub Apps as an alternate auth flow to OAuth. This flow would be something along the lines of - On sign up all we require is an email or username. When they have signed up and want to add a code host, Sourcegraph then can ask for more permissions. Through a GitHub App scopes are already predefined in GitHub There's been quite a bit of work moving towards this direction evidenced by some PRs I'd like to share [here](https://github.com/sourcegraph/sourcegraph/pull/29467) and [here](https://github.com/sourcegraph/sourcegraph/pull/31038) just as examples. A caveat is that this is WIP for Sourcegraph.com and I, at the moment may not have an exact timeline for managed and self-hosted instances.

In summary, I believe the permissions issue will be addressed with GitHub Apps and I do not expect we would ask more than we have today.

I hope this helps clarify your thoughts.

### Relevant Docs Pages Used/Created

- https://docs.sourcegraph.com/admin/repo/permissions#github)
- https://docs.sourcegraph.com/admin/repo/permissions#gitlab 
- https://docs.sourcegraph.com/admin/repo/permissions#bitbucket-server
- https://github.com/sourcegraph/sourcegraph/pull/29467
- https://github.com/sourcegraph/sourcegraph/pull/31038

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 11138.md -->
