# Lyft Code Insights max_connections and time series label swap<!-- Ticket Title  Hint: include keywords to make it searchable -->
 
- Zendesk Link: [#6220](https://sourcegraph.zendesk.com/agent/tickets/6220)
- Application engineer: Quinlan Sparks
- Customer: Lyft, Inc. <!-- Redact if this contains personally identifying information -->
- Date: Feb 14

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->
 
## Technical Environment
- Version: 3.36.3
- Deployment: kubernetes
- External Services: GITHUB
- Auth Providers: saml
 
 
## Links
<!-- Data for application engineer manual entry -->
- Slack Links:
https://sourcegraph.slack.com/archives/C0174NVAREV/p1644854666651859
https://sourcegraph.slack.com/archives/C0174NVAREV/p1644854767124999
- GitHub Issue Link: N/A
- Doc Update Link: N/A
 
## Summary
### Description of Customer Issue
The customer was experimenting with Code Insights and encountered two issues - two labels were swapped on one graph, and there were intermittent issues with displaying more than one or two insights.
 
### Troubleshooting Steps
Inability to display more than two insights: I advised the customer to increase `max_connections` to 100 (up from the default 20), which stabilized the issue some but did not fully resolve it. Since that helped, I recommended increasing it further and reminded them that they may need to also increase `work_mem` to compensate.

Time series label swap: This was a known and addressed issue, which should be solved by upgrading from version 3.33 to 3.36. The customer also asked to clarify if they needed to upgrade one version at a time.
 
### Resolution
Increasing `max_connections` to 300 has stabilized the display issue with up to four insights, and the customer knows how to continue adjusting on their own should this error appear again.
 
The upgrade resolved the label swap, as anticipated. 
 
### Relevant Docs Pages Used/Created
https://docs.sourcegraph.com/admin/config/postgres-conf#max-connections

https://docs.sourcegraph.com/admin/updates#updating-sourcegraph

https://github.com/sourcegraph/sourcegraph/issues/27879
 
### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->
`FATAL: sorry, too many clients already (SQLSTATE 53300)`

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 6220.md -->
