
# Dirty Database <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#6718](https://sourcegraph.zendesk.com/agent/tickets/6718)
- Application engineer: Gabe Torres
- Customer: Capital One <!-- Redact if this contains personally identifying information -->
- Date: Mar 8

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​3.36.1
- Deployment: ECS - Docker Compose
- External Services:
- Auth Providers:


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C01QNMSLTFZ/p1646782437119909 
- GitHub Issue Link:
- Doc Update Link:

## Summary
### Description of Customer Issue
The customer got a failed migration error 1528395834

### Troubleshooting Steps
Tried to run the steps in the dirty database doc. Running the migration failed because some changes had already been applied. Running the migration with parts commented out worked.
https://github.com/sourcegraph/sourcegraph/blob/v3.36.1/migrations/frontend/1528395834_squashed_migrations.up.sql  

### Resolution
The customer commented out sections of the migration that had already been applied.

### Relevant Docs Pages Used/Created
https://docs.sourcegraph.com/admin/how-to/dirty_database_pre_3_37 

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->
The target schema is marked as dirty and no other migration operation is seen running on this schema. The last migration operation over this schema has failed (or, at least, the migrator instance issuing that migration has died). Please contact support@sourcegraph.com for further assistance.

```psql:runme.sql:26: ERROR:  type "cm_email_priority" already exists
psql:runme.sql:31: ERROR:  current transaction is aborted, commands ignored until end of transaction block
psql:runme.sql:36: ERROR:  current transaction is aborted, commands ignored until end of transaction block
psql:runme.sql:44: ERROR:  current transaction is aborted, commands ignored until end of transaction block
psql:runme.sql:54: ERROR:  current transaction is aborted, commands ignored until end of transaction block
psql:runme.sql:69: ERROR:  current transaction is aborted, commands ignored until end of transaction block```



<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 6718.md -->
