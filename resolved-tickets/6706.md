
# Code Insights time out 504<!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#6706](https://sourcegraph.zendesk.com/agent/tickets/6706)
- Application engineer: Giselle Northy
- Customer: Databricks <!-- Redact if this contains personally identifying information -->
- Date: Mar 8

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​
- Deployment: Kubernetes
- External Services:
- Auth Providers:


## Links
<!-- Data for application engineer manual entry -->
- Slack Links:
- GitHub Issue Link:
- Doc Update Link:

## Summary
### Customer Question

Trying to run a Code Insight but it returns 504 and times out.
`select:file lang:Less archived:no fork:no`


![image](https://user-images.githubusercontent.com/27694443/157551211-c5002825-694c-4b72-8a09-5cd280317b09.png)


### Application Engineer Answer

* Troubleshooting this: Ask them more about the repo that's timing out:
  * How big is it?
  * Does the query work in Sourcegraph?
  * If some query fail and others don't, what is the difference?

In this case they have a monorepo and several smaller. The monorepo was causing timeout. The work around is here:

ANSWER

Depending on the size of the Sourcegraph instance and the size of the repo, you may see odd behavior or timeout errors if you try to create a code insight running over a single large repository. In this case, it’s best to try:

1. Create the insight, but check the box to “run over all repositories.” (This sends the Insight backfilling jobs to the backend Sourcegraph instance worker which will handle them datapoint-by-datapoint. Running over an individual repository otherwise currently runs the jobs in bulk to generate its live preview.)
2. After the insight has finished running, filter the insight to the specific repo you originally wanted to use. The filter resolves instantly.


### Relevant Docs Pages Used/Created

https://github.com/sourcegraph/sourcegraph/pull/32350


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 6706.md -->
