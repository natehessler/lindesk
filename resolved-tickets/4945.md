

# Corrupted repos in trial-salesforce <!-- Ticket Title  Hint: include keywords to make it searchable -->



- Zendesk Link: [#4945](https://sourcegraph.zendesk.com/agent/tickets/4945)

- Application engineer: Mariam Adedeji

- Customer: Salesforce.com <!-- Redact if this contains personally identifying information -->

- Date: Dec 7


<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->

<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->



## Technical Environment

- Version: 3.17.2​

- Deployment: single docker

- External Services:

- Auth Providers: builtin





## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C01D50MSA7L/p1638940266242200

- GitHub Issue Link: https://github.com/sourcegraph/sourcegraph/issues/28897, https://github.com/sourcegraph/sourcegraph/issues/28899

- Doc Update Link:



## Summary
Keegan was already assisting them with this issue before I jumped in, so I just watched out for where I'm needed. 
 
Ryan from Repo-management has raised GitHub issues for this issue and their concern regarding removing repo from the UI on prod and has been communicated to them by Keegan and Mike. GitHub issues are listed below
How to prevent repos from getting corrupted: Issue link
How to recover from a corrupted repo, without SSH access: issue link 

### Description of Customer Issue
After looking into the logs from the Gitserver, they detected that some repos were corrupted due to the fact that some repos were created as non-bare, whereas other repos (like perforce/automation) are cloned as bare which could be because the config file wasn’t written to disk during the hard shutdown they did a couple of days back and the bare = true and the other options did not make it to the disk in time.



### Resolution
1. Update config
2. Find the 148 affected repos in the working tree by running this command: find . -name .git -exec bash -c "cd '{}' && git config --bool core.bare true" \;
3. Remove all affected repos by running this docker-compose logs -f | grep "error" | sed [find the repo name] | rm -rf



### Relevant Docs Pages Used/Created



### Relevant Error / Logs

<!-- Please redact keys, tokens, and personal identifying information -->

