​
# Unity: 3.43.2 Over-active Tracing Error Causing OOM <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#11157](https://sourcegraph.zendesk.com/agent/tickets/11157)
- Application engineer: Alex Jean-Baptiste
- Customer: Unity <!-- Redact if this contains personally identifying information -->
- Date: September 22, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.36.2​
- Deployment: kubernetes
- External Services: GITHUB,GITLAB
- Auth Providers: builtin,saml


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C01FKCMAVH9/p1663921742365109
- GitHub Issue Link: https://github.com/sourcegraph/sourcegraph/pull/42003
- Doc Update Link: N/A
​
## Summary
### Description of Customer Issue
​
​Hi. We upgrading our production instance to 3.43.2 today and so far I noticed both frontend pods dying simultaneously on intervals 
``` 
panic: runtime error: invalid memory address or nil pointer dereference 
[signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0x1d75ff5]
goroutine 1116 [running]: 
<http://github.com/sourcegraph/sourcegraph/internal/search/backend.(*meteredSearcher).StreamSearch(0xc001b10750|github.com/sourcegraph/sourcegraph/internal/search/backend.(*meteredSearcher).StreamSearch(0xc001b10750>, {0x92f56b8, 0xc002861020}, {0x92c7820, 0xc0015b7040}, 0xc002836f60, {0x92cfb00?, 0xc0020fec40}) 
<http://github.com/sourcegraph/sourcegraph/internal/search/backend/metered_searcher.go:101|github.com/sourcegraph/sourcegraph/internal/search/backend/metered_searcher.go:101> +0xc55 
<http://github.com/sourcegraph/sourcegraph/internal/search/backend.(*HorizontalSearcher).StreamSearch.func1({0xc0012694a0|github.com/sourcegraph/sourcegraph/internal/search/backend.(*HorizontalSearcher).StreamSearch.func1({0xc0012694a0>, 0x24}, {0x92f8ec0, 0xc001b107b0}) 
<http://github.com/sourcegraph/sourcegraph/internal/search/backend/horizontal.go:91|github.com/sourcegraph/sourcegraph/internal/search/backend/horizontal.go:91> +0x1d1 
created by <http://github.com/sourcegraph/sourcegraph/internal/search/backend.(*HorizontalSearcher).StreamSearch|github.com/sourcegraph/sourcegraph/internal/search/backend.(*HorizontalSearcher).StreamSearch> 
<http://github.com/sourcegraph/sourcegraph/internal/search/backend/horizontal.go:90|github.com/sourcegraph/sourcegraph/internal/search/backend/horizontal.go:90> +0x41f```
​

### Troubleshooting Steps
Memory usage on zoektwas checked several times using Grafana as well as checking logs form the service.
​

### Resolution
The memory limit for indexedSearchIndexer was increased to 24GB up from the prescribed 8GB on the Helm chart. https://sourcegraph.com/github.com/sourcegraph/deploy-sourcegraph-helm@release/3.43/-/blob/charts/sourcegraph/values.yaml?L561&subtree=true

### Relevant Docs Pages Used/Created
​https://docs.sourcegraph.com/admin/observability/troubleshooting#scenario-zoekt-webserver-is-in-a-crashloopbackoff-and-err-cannot-allocate-memory
​
### Relevant Error / Logs
FRONTEND LOGS
​panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0x1d75ff5]

goroutine 1116 [running]:
github.com/sourcegraph/sourcegraph/internal/search/backend.(*meteredSearcher).StreamSearch(0xc001b10750, {0x92f56b8, 0xc002861020}, {0x92c7820, 0xc0015b7040}, 0xc002836f60, {0x92cfb00?, 0xc0020fec40})
 github.com/sourcegraph/sourcegraph/internal/search/backend/metered_searcher.go:101 +0xc55
github.com/sourcegraph/sourcegraph/internal/search/backend.(*HorizontalSearcher).StreamSearch.func1({0xc0012694a0, 0x24}, {0x92f8ec0, 0xc001b107b0})
 github.com/sourcegraph/sourcegraph/internal/search/backend/horizontal.go:91 +0x1d1
created by github.com/sourcegraph/sourcegraph/internal/search/backend.(*HorizontalSearcher).StreamSearch
 github.com/sourcegraph/sourcegraph/internal/search/backend/horizontal.go:90 +0x41f
​
ZOEKT LOGS
​indexed-search-1 -c zoekt-indexserver
2022/09/23 09:50:14 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00000.zoekt.1265284372.tmp
2022/09/23 09:50:14 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00001.zoekt.2534774453.tmp
2022/09/23 09:50:14 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00002.zoekt.2956279618.tmp
2022/09/23 09:50:14 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00003.zoekt.2353710762.tmp
2022/09/23 09:50:14 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00004.zoekt.3211309527.tmp
2022/09/23 09:50:14 updating index 309 github.cds.internal.unity3d.com/unity/unity@HEAD=25f6ddfc8c85392dcc9d3c40e7305e07a5e39d73,2020.3/platform/hmi/qnx=cf0f9aa17e33c76766989d47e670845bc04de94d reason=content-mismatch
2022/09/23 09:53:13 error indexing 309 github.cds.internal.unity3d.com/unity/unity@HEAD=25f6ddfc8c85392dcc9d3c40e7305e07a5e39d73,2020.3/platform/hmi/qnx=cf0f9aa17e33c76766989d47e670845bc04de94d: command [zoekt-git-index -submodules=false -incremental -branches HEAD,2020.3/platform/hmi/qnx -file_limit 1048576 -parallelism 8 -index /data/index -require_ctags /data/index/.indexserver.tmp/tmpfriend-7-166503360/github.cds.internal.unity3d.com%2Funity%2Funity.git] failed: signal: killed
OUT: 2022/09/23 09:52:36 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00002.zoekt: 224000278 index bytes (overhead 2.1)
2022/09/23 09:52:38 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00000.zoekt: 285987767 index bytes (overhead 2.7)
2022/09/23 09:52:40 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00001.zoekt: 266477400 index bytes (overhead 2.5)
2022/09/23 09:52:57 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00003.zoekt: 287494792 index bytes (overhead 2.7)
2022/09/23 09:53:08 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00004.zoekt: 286536341 index bytes (overhead 2.7)
2022/09/23 09:53:15 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00000.zoekt.680931629.tmp
2022/09/23 09:53:15 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00001.zoekt.1350864322.tmp
2022/09/23 09:53:15 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00002.zoekt.2455959735.tmp
2022/09/23 09:53:15 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00003.zoekt.3240921833.tmp
2022/09/23 09:53:15 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00004.zoekt.4150774060.tmp
2022/09/23 09:53:16 updating index.meta 2570 github.com/Unity-Technologies/DOTS-training-samples@HEAD=c1675903f8b2deb4cb316703e589d3434dce6923
2022/09/23 09:53:16 updated meta 2570 github.com/Unity-Technologies/DOTS-training-samples@HEAD=c1675903f8b2deb4cb316703e589d3434dce6923 in 904.202µs
2022/09/23 09:53:16 updating index 14459 github.com/Unity-Technologies/GoogleAuditor@HEAD=06d647f95c65d03ee5231bf45cc854a3b52254aa reason=content-mismatch
2022/09/23 09:53:20 updated index 14459 github.com/Unity-Technologies/GoogleAuditor@HEAD=06d647f95c65d03ee5231bf45cc854a3b52254aa in 3.672936799s
2022/09/23 09:53:21 updating index 309 github.cds.internal.unity3d.com/unity/unity@HEAD=25f6ddfc8c85392dcc9d3c40e7305e07a5e39d73,2020.3/platform/hmi/qnx=cf0f9aa17e33c76766989d47e670845bc04de94d reason=content-mismatch
2022/09/23 09:56:15 error indexing 309 github.cds.internal.unity3d.com/unity/unity@HEAD=25f6ddfc8c85392dcc9d3c40e7305e07a5e39d73,2020.3/platform/hmi/qnx=cf0f9aa17e33c76766989d47e670845bc04de94d: command [zoekt-git-index -submodules=false -incremental -branches HEAD,2020.3/platform/hmi/qnx -file_limit 1048576 -parallelism 8 -index /data/index -require_ctags /data/index/.indexserver.tmp/tmpfriend-7-166503360/github.cds.internal.unity3d.com%2Funity%2Funity.git] failed: signal: killed
OUT: 2022/09/23 09:55:42 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00002.zoekt: 224000278 index bytes (overhead 2.1)
2022/09/23 09:55:44 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00000.zoekt: 285987767 index bytes (overhead 2.7)
2022/09/23 09:55:45 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00001.zoekt: 266477403 index bytes (overhead 2.5)
2022/09/23 09:56:03 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00003.zoekt: 287494785 index bytes (overhead 2.7)
2022/09/23 09:56:14 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00004.zoekt: 286536353 index bytes (overhead 2.7)
2022/09/23 09:56:17 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00000.zoekt.4263559608.tmp
2022/09/23 09:56:17 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00001.zoekt.231376229.tmp
2022/09/23 09:56:17 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00002.zoekt.2737125410.tmp
2022/09/23 09:56:17 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00003.zoekt.2167196977.tmp
2022/09/23 09:56:17 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00004.zoekt.784479449.tmp
2022/09/23 09:56:17 updating index 309 github.cds.internal.unity3d.com/unity/unity@HEAD=25f6ddfc8c85392dcc9d3c40e7305e07a5e39d73,2020.3/platform/hmi/qnx=cf0f9aa17e33c76766989d47e670845bc04de94d reason=content-mismatch
2022/09/23 09:59:17 error indexing 309 github.cds.internal.unity3d.com/unity/unity@HEAD=25f6ddfc8c85392dcc9d3c40e7305e07a5e39d73,2020.3/platform/hmi/qnx=cf0f9aa17e33c76766989d47e670845bc04de94d: command [zoekt-git-index -submodules=false -incremental -branches HEAD,2020.3/platform/hmi/qnx -file_limit 1048576 -parallelism 8 -index /data/index -require_ctags /data/index/.indexserver.tmp/tmpfriend-7-166503360/github.cds.internal.unity3d.com%2Funity%2Funity.git] failed: signal: killed
OUT: 2022/09/23 09:58:41 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00002.zoekt: 224000277 index bytes (overhead 2.1)
2022/09/23 09:58:43 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00000.zoekt: 285987770 index bytes (overhead 2.7)
2022/09/23 09:58:45 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00001.zoekt: 266477406 index bytes (overhead 2.5)
2022/09/23 09:59:01 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00003.zoekt: 287494789 index bytes (overhead 2.7)
2022/09/23 09:59:11 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00004.zoekt: 286536341 index bytes (overhead 2.7)
2022/09/23 09:59:19 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00000.zoekt.3048290396.tmp
2022/09/23 09:59:19 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00001.zoekt.4277188450.tmp
2022/09/23 09:59:19 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00002.zoekt.3924357632.tmp
2022/09/23 09:59:19 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00003.zoekt.2774255937.tmp
2022/09/23 09:59:19 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00004.zoekt.979057286.tmp
2022/09/23 09:59:19 updating index 15184 github.cds.internal.unity3d.com/unity/python-github@HEAD=4406488d81c9b025a73fe06122b14937e5e5d8db reason=content-mismatch
2022/09/23 09:59:20 updated index 15184 github.cds.internal.unity3d.com/unity/python-github@HEAD=4406488d81c9b025a73fe06122b14937e5e5d8db in 199.460649ms
2022/09/23 09:59:20 updating index 309 github.cds.internal.unity3d.com/unity/unity@HEAD=25f6ddfc8c85392dcc9d3c40e7305e07a5e39d73,2020.3/platform/hmi/qnx=cf0f9aa17e33c76766989d47e670845bc04de94d reason=content-mismatch
2022/09/23 10:02:14 error indexing 309 github.cds.internal.unity3d.com/unity/unity@HEAD=25f6ddfc8c85392dcc9d3c40e7305e07a5e39d73,2020.3/platform/hmi/qnx=cf0f9aa17e33c76766989d47e670845bc04de94d: command [zoekt-git-index -submodules=false -incremental -branches HEAD,2020.3/platform/hmi/qnx -file_limit 1048576 -parallelism 8 -index /data/index -require_ctags /data/index/.indexserver.tmp/tmpfriend-7-166503360/github.cds.internal.unity3d.com%2Funity%2Funity.git] failed: signal: killed
OUT: 2022/09/23 10:01:42 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00002.zoekt: 224000240 index bytes (overhead 2.1)
2022/09/23 10:01:43 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00000.zoekt: 285987767 index bytes (overhead 2.7)
2022/09/23 10:01:45 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00001.zoekt: 266477399 index bytes (overhead 2.5)
2022/09/23 10:02:03 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00003.zoekt: 287494800 index bytes (overhead 2.7)
2022/09/23 10:02:13 finished /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00004.zoekt: 286536356 index bytes (overhead 2.7)
2022/09/23 10:02:16 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00000.zoekt.2604556852.tmp
2022/09/23 10:02:16 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00001.zoekt.23701844.tmp
2022/09/23 10:02:16 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00002.zoekt.3306155319.tmp
2022/09/23 10:02:16 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00003.zoekt.3479749088.tmp
2022/09/23 10:02:16 removing old tmp file: /data/index/github.cds.internal.unity3d.com%2Funity%2Funity_v16.00004.zoekt.13308664.tmp
2022/09/23 10:02:16 updating index 309 github.cds.internal.unity3d.com/unity/unity@HEAD=25f6ddfc8c85392dcc9d3c40e7305e07a5e39d73,2020.3/platform/hmi/qnx=cf0f9aa17e33c76766989d47e670845bc04de94d reason=content-mismatch
<!-- Please redact keys, tokens, and personal identifying information -->
​

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 11157.md -->
