​
# Re: Sourcegraph Helm deployment <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#9597](https://sourcegraph.zendesk.com/agent/tickets/9597)
- Application engineer: Alex Jean-Baptiste
- Customer: Balyasny Asset Management LP <!-- Redact if this contains personally identifying information -->
- Date: July 7, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​3.40.2
- Deployment: Kuberntes
- External Services: external RDS database
- Auth Providers: builtin


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: N/A (EMAIL)
- GitHub Issue Link: N/A
- Doc Update Link: N/A
​
## Summary
### Customer Question
Great to meet you today! As I mentioned on the call, we'll be working closely with our support team (cc'd here) to get your instance upgraded from 3.27.4 to the current version (3.41.0). We'll be in touch soon to coordinate next steps.
​
​
### Application Engineer Answer
​
​Thanks for your time yesterday, Matt.

After looking over the information from our call and the information you provided in your follow-up email you are safe to proceed to upgrade using our docs here.

You previously mentioned that you were using a separate RDS database.

Based on the information you sent :

Update base/frontend/Sourcegraph-frontend.Deployment.yaml
Change PGHOST to RDS address
Change PGUSER to RDS username
Change PGPASSWORD to reference a Kubernetes secret with the DB password
Change SRC_GIT_SERVERS to be the list of 6 gitserver replicas



It would seem that you are only using an external database for the frontend database of Sourcegraph (the database on which most of Sourcegraph's main functionality depends).


If you have not completed these steps for your Code Intelligence database then you are still using a built-in Postgres database that is bundled with our official Docker image.

I then want to bring your attention to upgrade instructions for version 3.29 -> 3.30.3 and 3.30.x -> 3.31.0.
There is a manual database migration that must be done for your Code Intelligence database should you not externalize it before this version of Sourcegraph.

If you do use an external service for this database before upgrading to 3.30.3 from 3.29.0 then feel free to disregard the above manual migration information.

Once you've upgraded Sourcegraph to 3.37.0 you are also able to externalize your codeinsights-db as well by following these instructions.


Any other potential considerations when upgrading have been documented here.


At any point please feel free to reach out for any questions you may have.


I will check in with you next week Monday should I not hear from

### Relevant Docs Pages Used/Created
​https://docs.sourcegraph.com/admin/external_services/postgres#instructions
https://docs.sourcegraph.com/admin/updates/kubernetes#3-29-3-30-3
​https://docs.sourcegraph.com/admin/updates/kubernetes#3-30-x-3-31
​https://sourcegraph.slite.com/p/aRkieyykA6HLL4/Code-Insights-Migrate-to-managed-database
​https://docs.sourcegraph.com/admin/updates/kubernetes
​
​

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 9597.md -->
