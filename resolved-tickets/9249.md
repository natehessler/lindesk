
# Symbols pod processes make node unstable <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#9249](https://sourcegraph.zendesk.com/agent/tickets/9249)
- Application engineer: Michael Bali
- Customer: Coupang <!-- Redact if this contains personally identifying information -->
- Date: June 22, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​3.39.1
- Deployment: Helm
- External Services: GITHUB
- Auth Providers: github


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C02NFUV7V9A/p1655948597600739
- GitHub Issue Link: N/A
- Doc Update Link: N/A

## Summary
### Description of Customer Issue
The symbol pod crashes the node.

### Troubleshooting Steps

Try running `df -h` in the `symbols` container to see how much disk is used vs free (in case the disk is filling up)

Does the symbols sidebar load on one of their smaller repos?
Are there any other relevant messages in the logs?
Try running `touch /tmp/tags.1234` to see if there's an error
What's the output of `ls -lh /` and `ls -lh /tmp`? Maybe the ctags process doesn't have permission to write to `/tmp``
What's the output of `ps auxww`? That's to check the user who is running ctags
In grafana, do you see this alert firing `symbols: 25+ current fetch queue size`


### Resolution
tmp directory was a `Read-Only File SYstem` Directory. ctags needs an existing writable temp directory:

There are 2 solutions I know of:
- Set TMPDIR, see example: https://github.com/sourcegraph/deploy-sourcegraph-helm/pull/132/files?w=1
- Make sure the root file system is writable by the user running the symbols service. The only place I've seen the user changed is here: https://github.com/sourcegraph/deploy-sourcegraph-helm/blob/b6d554e3f594b9c43951f84520f174fae29114ab/charts/sourcegraph/values.yaml#L997

Solution One resolves the issue for them.

### Relevant Docs Pages Used/Created
https://github.com/sourcegraph/deploy-sourcegraph-helm/pull/132/files?w=1
### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->

```
t=2022-06-23T20:00:01+0000 lvl=eror msg=codeintel.symbols.parser.HandleParseRequest error="parser.Parse: fatal ctags error for xxx/xxxx/xxx/xxxx/xxxx.jsonnet: cannot open temporary file: /tmp/tags.XXXXXX" count=1.000 elapsed=0.005 path=deploy/safety_compliance/go_cms_api/template/_image_tag.jsonnet fileSize=74
```


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 9249.md -->
