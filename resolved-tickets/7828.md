
# Questions on the Usage of Kustomize <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#7828](https://sourcegraph.zendesk.com/agent/tickets/7828)
- Application engineer: Michael Bali
- Customer: Allegro <!-- Redact if this contains personally identifying information -->
- Date: Apr 25

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During the Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​3.38.0
- Deployment: kubernetes
- External Services: GITHUB
- Auth Providers: builtin,github


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C02BF1E7VAN/p1650886295886509
- GitHub Issue Link: N/A
- Doc Update Link: N/A

## Summary
### Customer Question
- The User wants to know if it's possible to use the overlays provided in the subdirectories of deploy-sourcegraph/overlays with their own created overlays for a different purpose.

- don’t see an way to use namespace, storage, custom overlay at the same time? Every time that I run overlay-generate-cluster it rewrites everything

### Application Engineer Answer
- Yes you can use the overlays provided in the subdirectories of `deploy-sourcegraph/overlays` with your own created overlays at the same time.You just need to follow the instructions in this [section](https://docs.sourcegraph.com/admin/install/kubernetes/kustomize#custom-overlays.) of the doc I shared earlier.

- Within the `kustomization.yaml` you can define patches, transformation, and more.
I see you want to use [PatchesStrategicMerge](https://kubectl.docs.kubernetes.io/guides/example/inline_patch/) to make partial changes to the `namespaced/prometheus/prometheus.ClusterRoleBinding.yaml `in your Kustomization file.
In the [docs](https://kubectl.docs.kubernetes.io/guides/example/inline_patch/#patch-delete), I see what you are referring to now, I did some further investigations and came across this [link](https://stackoverflow.com/questions/71165168/can-someone-explain-patchesstrategicmerge). So I believe you can do something around the below following the stackoverflow link as a guide and it shouldn't overwrite.

```
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: sourcegraph
resources:
  - ../bases/deployments
  - ../bases/rbac-roles
  - ../bases/pvcs
patchesStrategicMerge:
  - ../namespaced/prometheus/prometheus.ClusterRoleBinding.yaml
  - ../namespaced/prometheus/prometheus.ConfigMap.yaml
  - ../namespaced/cadvisor/cadvisor.ClusterRoleBinding.yaml
transformers:
  - metadataLabelTransformer.yaml

```

### Relevant Docs Pages Used/Created

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 7828.md -->
