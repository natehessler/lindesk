
# shipt - help write comby batch change <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#8734](https://sourcegraph.zendesk.com/agent/tickets/8734)
- Application engineer: Warren Gifford
- Customer: Target <!-- Redact if this contains personally identifying information -->
- Date: June 3, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.24.1​
- Deployment: kubernetes
- External Services: GITHUB
- Auth Providers: builtin,openidconnect


## Links
<!-- Data for application engineer manual entry -->
- Slack Links:
- GitHub Issue Link:
- Doc Update Link:

## Summary
### Customer Question

I’m trying to add some required alpine packages in Dockerfiles across all our repos.
Here is what I’ve hacked together via comby so far:
comby -matcher .sh -in-place 'apk:[opts]add :[paks~.*(?!gcc).*]' 'apk:[opts]add :[paks] gcc' Dockerfile
comby -matcher .sh -in-place 'apk:[opts]add :[paks~.*(?!g++).*]' 'apk:[opts]add :[paks] g++' Dockerfile

Basically, if a line in Dockerfile contains apk add (potentially with options between the two keywords) and is missing the gcc package, I want to add it at the end. Same for g++.
This kinda does what I intended, except it’s also adding those packages to a second image declared in same Dockerfile but it does not require the compilers, so I have a new requirement that the apk add line I want to modify must already contain the git or make package, so I can infer that is the image that will be used for building the code.
Question is, how would I modify the above commands to accomplish this? Is there a cleaner way to do this?

### Application Engineer Answer

Customer answered themselves

comby -matcher .sh -in-place 'apk:[opts]add :[paks~.*(?=make|git)(?!gcc).*]' 'apk:[opts]add :[paks] gcc' *file
      comby -matcher .sh -in-place 'apk:[opts]add :[paks~.*(?=make|git)(?!g\+\+).*]' 'apk:[opts]add :[paks] g++' *file


### Relevant Docs Pages Used/Created

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 8734.md -->
