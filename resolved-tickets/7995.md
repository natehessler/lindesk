​
# Customer Migrated To Helm Deployment Without Proper Guidance <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#7995](https://sourcegraph.zendesk.com/agent/tickets/7995)
- Application engineer: Alex Jean-Baptiste
- Customer: Curve <!-- Redact if this contains personally identifying information -->
- Date: May 4, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.31.2​
- Deployment: kubernetes
- External Services: GITLAB
- Auth Providers: builtin,saml
​

## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C02EKVAHQPN/p1651677924563309
- GitHub Issue Link: https://github.com/sourcegraph/customer/issues/915
- Doc Update Link: https://github.com/sourcegraph/customer/issues/915

## Summary
### Description of Customer Issue
The customer experienced an empty repository error in the Sourcegraph UI. In the customer's gitserver logs, the customer received a repo ownership error. These errors occurred after the customer migrated from a non-Helm deployment of Sourcegraph to a Helm deployment. The Helm deployment configuration at this current moment requires rootless containers to be run.
​
### Troubleshooting Steps
 This error was not reproducible outside of the customer's environment.
​
### Resolution
The customer was instructed to run the  chown commands in this kustomize overlay in order to change the permissions of all persistent volumes for all applicable services. The frontend  searcher services were excluded due to containing only emptyDir.
 
### Relevant Docs Pages Used/Created
​https://kubernetes.io/docs/concepts/storage/volumes/#emptydir
​https://github.com/sourcegraph/deploy-sourcegraph/tree/master/overlays/migrate-to-nonprivileged
​
### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->
​t=2022-05-04T16:15:10+0000 lvl=eror msg="handleGetObject: getting object" error="git command [git rev-parse bf774605be494f876ea510e59de433efdfa9aaa1^{tree}] failed (output: \"fatal: unsafe repository ('/data/repos/git.curve.tools/tech/platform/kubernetes-state/.git' is owned by someone else)\\nTo add an exception for this directory, call:\\n\\n\\tgit config --global --add safe.directory /data/repos/git.curve.tools/tech/platform/kubernetes-state/.git\\n\"): exit status 128

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 7995.md -->
