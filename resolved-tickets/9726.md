
# Gitserver continuously clones monorepo <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#9726](https://sourcegraph.zendesk.com/agent/tickets/9726)
- Application engineer: Michael Bali
- Customer: Booking.com <!-- Redact if this contains personally identifying information -->
- Date: July 14, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.37.0​
- Deployment: kubernetes
- External Services: GITLAB
- Auth Providers: gitlab


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C024D1ESXUH/p1657796122132189
- GitHub Issue Link: https://github.com/sourcegraph/customer/issues/1128#issuecomment-1191122063
- Doc Update Link: N/A

## Summary
### Description of Customer Issue
Gitserver constantly reclones its mono repo. This is a situation where we fail to run `git prune` and another where we fail to run `sg maintenance`. These both imply that the repo is becoming corrupted and our code to reclone a corrupted repo is being triggered. This also breaks search into the repo when recloning.

### Troubleshooting Steps
- The workaround to remove and reclone the repo following the instructions here: https://docs.sourcegraph.com/admin/how-to/remove-repo
- The above was no longer ideal because this repo corruption now happens frequently and a permanent fix is required.

### Resolution
The admin Moved to the old garbage collection method by setting the following env variable to disable the old and new job.
```
SRC_ENABLE_SG_MAINTENANCE=false
SRC_ENABLE_GC_AUTO=true
```


Note: The garbage collection method is a process we are looking at improving in the coming version.

### Relevant Docs Pages Used/Created

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->
`https://gitlab.xxxxx.com/core/main.git did not send all necessary objects`


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 9726.md -->
