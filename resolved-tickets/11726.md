​
# Morgan Stanley: DB Deadlocks After Upgrading To 3.33 <!-- Ticket Title  Hint: include keywords to make it searchable -->
​
- Zendesk Link: [#11726](https://sourcegraph.zendesk.com/agent/tickets/11726)
- Application engineer: Alex Jean-Baptiste
- Customer: Morgan Stanley <!-- Redact if this contains personally identifying information -->
- Date: October 17, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​3.33
- Deployment: k8s on OpenShift
- External Services: TBA
- Auth Providers: TBA


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C03H69Z7XQT/p1666796813221859, https://sourcegraph.slack.com/archives/C03TGHH1S3V/p1666025888006269
- GitHub Issue Link: https://github.com/sourcegraph/customer/issues/1559
- Doc Update Link: N/A

## Summary
### Customer Question
The customer experienced consistent DB Deadlocks after upgrading to v3.33.
The customer was also simultaneously experiencing searcher evictions that would occur every few days.
The pressing issue was that the frontend service was constantly restarting.
Once the above issues were resolved by wiping the customer's existing Sourcegraph installation and restarting with a fresh installation, all the |above issues were resolved. 
We were unable to diagnose the |root cause with simultaneous issues occurring.
After the installation was complete and all was observed as stable, the customer was not receiving any data from cAdvisor in their Grafana Dashboard.

### Application Engineer Answer
Undiagnosable issues with the installation restarting and the inability to determine consistent versioning among the Sourcegraph services caused a fresh Sourcegraph installation to be suggested.
​
After this new installation was configured, all restarting services became stable. To fix the lack of metrics from cAdvisor a k8s Service Account was created for the Prometheus and Grafana services to allow them access to the k8s API server with the customer's applied cluster settings.
​
​
### Relevant Docs Pages Used/Created
​https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/
​

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 11726.md -->
