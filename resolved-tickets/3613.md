# Postgres index corruption 



- **Zendesk Link:** [#3613](https://sourcegraph.zendesk.com/agent/tickets/3613)

- **CSE:** Jason Harris

- **Customer:** Lyft, Inc. <!-- Redact if this contains personally identifying information -->


<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->

<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->



## Technical Environment

- **Version:** 3.30.4​

- **Deployment:** kubernetes

- **External Services:** GITHUB

- **Auth Providers:** saml





## Links
<!-- Data for CSE manual entry -->
- **Slack Links:** https://sourcegraph.slack.com/archives/C0174NVAREV/p1633021610031000 https://sourcegraph.slack.com/archives/C0174NVAREV/p1633021543029600

- **GitHub Issue Link:** N/A

- **Doc Update Link:** N/A



## Summary
### Description of Customer Issue:  

Customer said they were seeing an error message in the UI indicating that four of their repos could not be synced/may not be up to date. 



### Troubleshooting Steps:  

I noticed from another ticket that the customer mentioned that their pgsql container had index corruption ([here](https://sourcegraph.slack.com/archives/C0174NVAREV/p1633021543029600)). That being the case, no other troubleshooting steps were needed, as this was the very likely culprit of their repos not syncing.

### Resolution:

I sent the customer the docs for fixing corrupt Postgres indexes. After one week I received no response so I am closing this ticket. This approach has worked in the past and I'm very confident it worked here too.



### Relevant Error / Logs:  

<!-- Please redact keys, tokens, and personal identifying information -->

```sg=# create extension amcheck;
CREATE EXTENSION
sg=#
sg=# select bt_index_parent_check(c.oid, true), c.relname, c.relpages
sg-# from pg_index i
sg-# join pg_opclass op ON i.indclass[0] = op.oid
sg-# join pg_am am ON op.opcmethod = am.oid
sg-# join pg_class c ON i.indexrelid = c.oid
sg-# join pg_namespace n ON c.relnamespace = n.oid
sg-# where am.amname = 'btree'
sg-# -- Don't check temp tables, which may be from another session:
sg-# and c.relpersistence != 't'
sg-# -- Function may throw an error when this is omitted:
sg-# and i.indisready AND i.indisvalid;
ERROR:  down-link lower bound invariant violated for index "repo_name_unique"
DETAIL:  Parent block=3 child index tid=(55,2) parent page lsn=<REDACTED>.```
