

# postgres version incompatibility <!-- Ticket Title  Hint: include keywords to make it searchable -->



- Zendesk Link: [#5215](https://sourcegraph.zendesk.com/agent/tickets/5215)

- Application engineer: Kelvin Lee

- Customer: Apple <!-- Redact if this contains personally identifying information -->

- Date: December 17, 2021


<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->

<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->



## Technical Environment

- Version: 3.32.0​

- Deployment: docker-container

- External Services: OTHER

- Auth Providers: saml





## Links
<!-- Data for application engineer manual entry -->
- Slack Links: [Main thread](https://sourcegraph.slack.com/archives/C01NM1WFVH8/p1639774924013200),  [Similar thread](https://sourcegraph.slack.com/archives/C01NM1WFVH8/p1638490791004000)

- GitHub Issue Link: None

- Doc Update Link: None



## Summary

### Description of Customer Issue

Customer having issue getting a local, single container deployment up on their machine. Main issue seems to be a postgres incompatibility issue, as best revealed by the following command + its logged errors:

```
docker run --publish 7080:7080 --publish 127.0.0.1:3370:3370 --rm --volume ~/.sourcegraph/config:/etc/sourcegraph --volume ~/.sourcegraph/data:/var/opt/sourcegraph sourcegraph/server:3.34.2
✱ Finished initializing the internal database.
20:08:24           zoekt-webserver | 2021/12/17 20:08:24 listening on 127.0.0.1:3070
20:08:24                  postgres | 2021-12-17 20:08:24.900 UTC [152] FATAL:  database files are incompatible with server
20:08:24                  postgres | 2021-12-17 20:08:24.900 UTC [152] DETAIL:  The data directory was initialized by PostgreSQL version 11, which is not compatible with this version 12.9.
20:08:24                  postgres | Terminating postgres
postgres died. Shutting down...
```



### Troubleshooting Steps
Tried a couple of things:
- [brew postgresql -upgrade-database](https://sourcegraph.slack.com/archives/C01NM1WFVH8/p1639764720011800?thread_ts=1638490791.004000&cid=C01NM1WFVH8) (as suggested by Jason)
- deleting some of the directories in ~/.sourcegraph (described [here](https://sourcegraph.slack.com/archives/C01NM1WFVH8/p1638836052006900?thread_ts=1638490791.004000&cid=C01NM1WFVH8) )

Latest suggestion was to delete the entirety of ~/.sourcegraph (insead of just sub-directories within it), but the customer had not yet tried that.


### Resolution
None, unfortunately. Still an issue. But moving to closed due to low response rate from customer.



### Relevant Docs Pages Used/Created



### Relevant Error / Logs

The data directory was initialized by PostgreSQL version 11, which is not compatible with this version 12.9



<!-- Please redact keys, tokens, and personal identifying information -->




<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 5215.md -->
