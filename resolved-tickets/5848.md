# JLL configuration questions: Setting up their own postgresQL database, external redis cache, consistent dirty database error <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#5848](https://sourcegraph.zendesk.com/agent/tickets/5848)
- Application engineer: Riana Shahid
- Customer: Jones Lang LaSalle, Inc (JLL) <!-- Redact if this contains personally identifying information -->
- Date: Jan 27

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​3.37
- Deployment: kubernetes
- External Services: azure redis cache, postgresQL
- Auth Providers:


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C01HW836940/p1643305206128600 but most conversation happened via email
- GitHub Issue Link: https://github.com/sourcegraph/customer/issues/675 , https://github.com/sourcegraph/customer/issues/699
- Doc Update Link: https://docs.sourcegraph.com/admin/install/kubernetes/configure#configure-custom-redis 
- Pull Request: https://github.com/sourcegraph/sourcegraph/pull/30660

## Summary
### Customer Question
Since this customer was setting up their trial, they first had more general questions about how to set up their redis endpoint, whether they can use a single external postgresQL database and whether they need to use overlays when configuring their instance. Later they kept running into a dirty database error every time sourcegraph is deployed.  
### Application Engineer Answer
There was some confusion about what exactly needed to be changed and where to configure their redis endpoint (docs were updated to include kubernetes-specific examples) but ultimately the customer had to update the `REDIS_ENDPOINT` value with the value for their redis cache. 
<br /> To answer their question of whether they can use their own postgres database, the answer is yes. This setup was a little different than what's recommended in that they are using the same server for frontend and code intel databases. This is not recommended [here](https://docs.sourcegraph.com/admin/external_services/postgres#using-your-own-postgresql-server) but when I asked in delivery, they said it should be fine since it's an external database. 
<br /> The customer was hesistant to use sourcegraph overlays because they were using Azure Dev Ops. I was not 100% sure on what role ADO plays and whether it takes care of some of the things that overlays handle so I gave a general explanation of what overlays do and let the customer know that I'm not familiar with whether ADO will be able to replace it. I believe this question was just to see if this was something they could cut out of their set up process but in the end they ended up using overlays. 
<br /> This customer's biggest issue was the dirty database error they got every time sourcegraph was deployed. In the beginning, it was thought this could be because the customer started the setup process with an internal database and later pointed sourcegraph to the external one without actually migrating but it was later found out that this dirty database thing is a known issue for the specific migration that the customer was trying to run. This is fixed in 3.37. 
### Relevant Docs Pages Used/Created
https://docs.sourcegraph.com/admin/how-to/dirty_database#how-to-troubleshoot-a-dirty-database
https://docs.sourcegraph.com/admin/postgres#upgrading-external-postgresql-instances
https://docs.sourcegraph.com/admin/external_services/postgres#using-your-own-postgresql-server
https://docs.sourcegraph.com/admin/install/kubernetes/configure#configure-custom-redis

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 5848.md -->
