# Stale user permissions resulting in a manual sync issue <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#10491](https://sourcegraph.zendesk.com/agent/tickets/10491)
- Application engineer: Stomzy Mwendwa
- Customer: Fiverr, Ltd. <!-- Redact if this contains personally identifying information -->
- Date: August 18, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.36.2â€‹
- Deployment: kubernetes
- External Services: GITHUB
- Auth Providers: github,github


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C01FG5LUWUU/p1660815376958639 
- GitHub Issue Link: N/A
- Doc Update Link: N/A

## Summary
### Description of Customer Issue
Customer reported having users report 0 results in Sourcegraph which gets resolved by running a manual permissions sync even if an automatic sync was done recently.
### Troubleshooting Steps
Check for repo-updater logs and grep for permissions
Database check on user_pending_permissions. Look for a count: select id, bind_id, updated_at, service_id, object_ids_ints from user_pending_permissions;
Explore further on correlation on bind_ids, service_ids and object_ids from the same table: select id, bind_id, updated_at, service_id, object_ids_ints from user_pending_permissions order by updated_at desc limit 10;

### Resolution
Adding
"permissions.syncScheduleInterval": 15,
gives us a time interval (in seconds) of how often each component picks up authorization changes in external services like for example through Okta etc. We can lower this if we'd like to sync permissions faster.
"permissions.syncOldestUsers": 10,
Number of user permissions to schedule for syncing in single scheduler iteration. In this case it'll be 10. We can increase this and observe
"permissions.syncUsersMaxConcurrency": 10,
Number of users we can sync permissions for at the same time can of course be increased if we need that.
With this configuration in a nutshell, every 15 seconds, we'd sync 10 users permissions
### Relevant Docs Pages Used/Created
https://docs.sourcegraph.com/@3.42/admin/repo/permissions#permissions-sync-scheduling 
### Relevant Error / Logs

