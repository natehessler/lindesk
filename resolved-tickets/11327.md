
# ... <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#11327](https://sourcegraph.zendesk.com/agent/tickets/11327)
- Application engineer: Rakesh Joshi
- Customer: Databricks <!-- Redact if this contains personally identifying information -->
- Date: October 3, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​3.43.0
- Deployment:Kubernetes
- External Services:GITHUB
- Auth Providers: builtin, saml


## Links
<!-- Data for application engineer manual entry -->
- Slack Links:https://sourcegraph.slack.com/archives/C02UM8A9M2R/p1664860562872949
- GitHub Issue Link:https://github.com/sourcegraph/sourcegraph/issues/41673
- Doc Update Link:

## Summary
### Description of Customer Issue
Customer has large LSIF data files which were consuming lot of space and resources while processing due to this they were facing issue with code intel/pgsql pods and failing LSIF uploads. To fix this they bulk deleted LSIF which again caused resource issues and also the deleted LSIF didn't free up table and disk space after deleting.


### Troubleshooting Steps
Checked logs for pgsql, code intel pods, verified Grafana charts for any issues
Checked worker logs for issues.
The large LSIF files seem to have caused the issue they bumped up the resources on code-intel and deleted failing LSIF uploads.
The system stabilised but deleted LSIF didn't clear up from DB and disk
Provided customer with SQL to manually clear up table space and redeem it.
Also connected with engineering on a data retention policy bug which would have helped customers periodically delete large lsif's and manage resources in a better manner. The bug is also closed now.



### Resolution
Bump up resources on the code-intel pod, delete LSIF failed uploads, free up table space by manual query execution and raised defect for enabling default data retention policies for all repositories.

### Relevant Docs Pages Used/Created

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 11327.md -->
