
# Code insights problem <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#4865](https://sourcegraph.zendesk.com/agent/tickets/4865)
- Application engineer: Alex Jean-Baptiste
- Customer: News Corp <!-- Redact if this contains personally identifying information -->
- Date: December 2, 2021

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​
- Deployment:
- External Services:
- Auth Providers:


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C02JSU299NY/p1638521466127300
- GitHub Issue Link: https://github.com/sourcegraph/customer/issues/617
- Doc Update Link: N/A

## Summary
### Description of Customer Issue
The customer experienced a Code Insights issue in which their set Code Insight was stuck in the following state: "This insight is still being processed."

### Troubleshooting Steps
1. The GraphQL Backend was used to check to see if the insight had persisted to the database.
2. worker, searcher, psql, and gitserver pods were checked for errors and restarted depending on whether or not they were in a failed or pending state.

### Resolution
An upgrade to Sourcegraph 3.35.1 was scheduled for the customer after consulting with SWE Coury Clark about this issue. The upgrade to Sourcegrph 3.35.1, deletion of the Code Insight, and a recreation of the Code Insight got the customer's issue resolved.

### Relevant Docs Pages Used/Created
https://docs.sourcegraph.com/code_insights/how-tos/Troubleshooting
https://docs.sourcegraph.com/code_insights

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->
From worker pod:
t=2021-12-22T18:35:10+0000 lvl=eror msg=workerutil.dbworker.store.insights_query_runner_jobs_store.QueuedCount e │s ="failed to con ect │  ──────────────────────────────│─────┘     │ rror="failed to connect to `host=pgsql user=sg database=sg`: dial error (dial tcp 172.20.8.194:5432: connect: co │o r=sg database=s `:  │─│                              ┘           │ nnection refused)" count=1.000 elapsed=1.020                                                                     │s                     │ ┘                                     │ t=2021-12-22T18:35:10+0000 lvl=eror msg="Failed to get queued job count" error="failed to connect to `host=pgsql │  ───────────────│────┘  │  user=sg database=sg`: dial error (dial tcp 172.20.8.194:5432: connect: connection refused)"

t=2021-12-22T22:44:08+0000 lvl=eror msg="error fetching commits from gitserver repo_id: 2001: git command [git log --format=format:%H%x00%x00%aN%x00%aE%x00%at%x00%cN% │
│ x00%cE%x00%ct%x00%B%x00%P%x00 --after=2020-12-22T22:43:24Z --date-order] failed (output: \"\"): exit status 128"



<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 4865.md -->
