
# Sourcegraph not mirroring "archived" status of GitHub Enterprise repo <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#6069](https://sourcegraph.zendesk.com/agent/tickets/6069)
- Application engineer: Gabe Torres
- Customer: Palantir Technologies <!-- Redact if this contains personally identifying information -->
- Date: Feb 7

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: 3.35.1​
- Deployment: docker-compose
- External Services: GITHUB
- Auth Providers: saml


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/CTNA0E80K/p1644261915303949 
- GitHub Issue Link: https://github.com/sourcegraph/sourcegraph/issues/12549 
- Doc Update Link:

## Summary
### Description of Customer Issue
Palantir is seeing archived repositories appear in search results. They're currently using repositoryQuery: 'Public' to sync GHE repositories because 'affiliated' would return 0 repos, as svc-sourcegraph(service account) is not associated with all the orgs/repos. We provided a workaround to switch to orgs but moving to orgs(https://docs.github.com/en/rest/reference/repos#list-organization-repositories) means orgs aren't always going to be live right away and may not be worth the cost. The ask here is to allow repositoryQuery: 'Public' return archived status so that they can omit archived repositories for their search results. 

### Troubleshooting Steps
We looked at the cloud icon to see if there were issues with code hosts connections. We saw some errors but this was with their github host connection and not with GHE.  
We confirmed that the repo was archived in GHE and that SG had an up to date clone.  
We confirmed that other repos were shown as archived but these repos were from GitHub.com not GHE.  
We confirmed that the token had the correct scope to fetch all repo data.  
We checked his code host config and saw that they were using repositoryQuery: 'Public' which has a known issue with showing archived status.  

### Resolution
Their CE created a product ticket to track progress on this since the customer doesn't want to spend time to change to orgs syncing.

### Relevant Docs Pages Used/Created
https://docs.sourcegraph.com/admin/external_service/github#repositoryquery-public-does-not-return-archived-status-of-a-repo 


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 6069.md -->
