I am closing this ticket as we have gotten perms syncing to work. Any new ticket that comes in regard perms syncing should link this one, however, as it has valuable context as to how they got here.
# Lockheed Martin: IdP configuration <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#7778](https://sourcegraph.zendesk.com/agent/tickets/7778)
- Application engineer: Jason Harris
- Customer: Lockheed Martin Space Systems <!-- Redact if this contains personally identifying information -->
- Date: April 21, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​3.39
- Deployment: Kubernetes
- External Services: GitLab
- Auth Providers: openidconnect


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C030CPM2ELR/p1650567115817229 
- GitHub Issue Link: https://github.com/sourcegraph/customer/issues/857 
- Doc Update Link: N/A

## Summary
### Description of Customer Issue
the customer reported being unable to sync permissions.

### Troubleshooting Steps
Throughout the troubleshooting process, checked all permissions tables in psql
Test both idps individually and compare with database entries.


### Resolution
Ultimately, discovered a database discrepancy where the user_id being returned by LM's idp was not matching the bind_id sourcegraph uses to bind repo permissions to users.
We created a GitLab group token with the following scopes, api, read_api and read_user and had users begin logging in using GitLab oauth app. This resolved the issue.

Note: This will likely need to be changed due to security reasons when it comes to their production environment. 

### Relevant Docs Pages Used/Created

### Relevant Error / Logs
<!-- Please redact keys, tokens, and personal identifying information -->


<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 7778.md -->
