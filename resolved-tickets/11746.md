​
# Checkr: yq Batch Change Errors <!-- Ticket Title  Hint: include keywords to make it searchable -->

- Zendesk Link: [#11746](https://sourcegraph.zendesk.com/agent/tickets/11746)
- Application engineer: Alex Jean-Baptiste
- Customer: <!-- Redact if this contains personally identifying information -->
- Date: October 18, 2022

<!-- Data populated from integration, speak to Ben Gordon or Michael Bali if not working -->
<!-- During Internal team trial, fill missing data manually (we are waiting for all data to sync) -->

## Technical Environment
- Version: ​
- Deployment:
- External Services:
- Auth Providers:


## Links
<!-- Data for application engineer manual entry -->
- Slack Links: https://sourcegraph.slack.com/archives/C03U5QATUH2/p1666109664797849
- GitHub Issue Link: N/A
- Doc Update Link: TBA
​
## Summary
### Customer Question
​
​hey, we're seeing a weird issue with a Batch Change today. 
```on: 
- repositoriesMatchingQuery: lang:yaml file:staging.*eu.yaml|production.*yaml
# In each repository, run this command. Each repository's resulting diff is captured. 
steps: 
- run: | 
for file in "${{ join repository.search_result_paths " " }}"; 
do 
yq -i '.microservice.podDefaults.kafkaConfigs[0] |= "legacy"' ${file} 
done 
container: mikefarah/yq``` 
When we apply the change, we get this error on every change 
```Error: failed copying from /tmp/temp3292629230 to .gitops/helm/accounts/production.yaml: open .gitops/helm/accounts/production.yaml: permission denied 
Command failed with status 1``` 
Any ideas?

### Application Engineer Answer
​At the current moment in time we have a workaround for using `yq` with Batch Changes.
Changing the container: value to golang:latest and modifying your steps to install the latest version of `yq` while running the batch change does work.

go install <http://github.com/mikefarah/yq/v4@latest|github.com/mikefarah/yq/v4@latest>


An updated version of your batch change using these changes is as follows:

on:
  - repositoriesMatchingQuery: lang:yaml file:staging.*eu.yaml|production.*yaml

# In each repository, run this command. Each repository's resulting diff is captured.
steps:
  - run: |
      go install <http://github.com/mikefarah/yq/v4@latest|github.com/mikefarah/yq/v4@latest>
      for file in "${{ join repository.search_result_paths " " }}";
      do
        yq -i '.microservice.podDefaults.kafkaConfigs[0] |= "legacy"' ${file}
      done
    container: golang:latest
​


### Relevant Docs Pages Used/Created
N/A

<!-- Once complete, upload a copy to https://github.com/sourcegraph/support-tools-internal/tree/main/resolved-tickets as a .md file -->
<!-- Name the file 11746.md -->
