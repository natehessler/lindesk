-   Application engineer: Giselle Northy
-   Customer: Pandora Media, Inc. 
-   Date: Mar 11
-   Version: ​
-   Deployment: Nomad!! Pure Docker
-   External Services:
-   Auth Providers:
-   Slack Links:
-   GitHub Issue Link:
-   Doc Update Link:
Code Insights failed to connect. Could not bring Front end up
Hello again! Just a call recap for ourselves and anyone who's following the thread:
-   With Code Insights disabled, Sourcegraph is up and running
-   Code Insights was enabled in previous Single Container install, but was not actively used i.e. no data in it
-   Therefore, no need to migrate Code Insights data from old instance
-   Discussed how Code Insights DB is a TimescaleDB
-   Noted that in Pure Docker the install instructions for Code Insights DB is to run it as a container, and not connected to external service
Next steps: You would test running Code Insights as a service within Sourcegraph deployment
He opted to keep Code insights Disabled. This is Nomad - unsupported but the root cause was PROBABLY he was trying to run Code Insights in a normal DB. Once I pointed that out, he seemed to understand.
More stuff!!
NOTE: I'm just pasting this here for sake of time. the TLDR is that Pandora also had a dirty db error at one point. But I learned that the failed migrating error can happen because the front end is trying to run a migration but the code insights (or other db?!) is not ready yet!!
His work around was to do this: Run sg run codeinsights-db in the background Delete codeinsights-db from the enterprise-codeinsights key in sg.config.yaml Run sg start enterprise-codeinsights
https://sourcegraph.slack.com/archives/C014ZCKMCAV/p1639604850155400
I'm having difficulty running code insights locally:
\$ env DISABLE_CODE_INSIGHTS=false sg start enterprise-codeinsights ... failed to initialize insights: Failed to connect to codeinsights database: failed upgrade migration 1000000001: unexpected EOF
When I run it a second time, I get a "dirty database" error.Is there a different way to run it? 18 replies
Coury Clark:palm_tree: 3 months ago
If you were to sg run codeinsights-db and check out the codeinsights_schema_migrations table, what do you see?
Chris Wendt  3 months ago
CleanShot 2021-12-15 at 14.49.18@2x.png CleanShot 2021-12-15 at 14.49.18@2x.png
Coury Clark:palm_tree: 3 months ago
maybe try this and re-run sg start ... update codeinsights_schema_migrations set dirty = false;
Coury Clark:palm_tree: 3 months ago
actually
Chris Wendt  3 months ago
Is it possible that enterprise-frontend is trying to run a migration before the codeinsights-db is ready? CleanShot 2021-12-15 at 14.50.28@2x.png CleanShot 2021-12-15 at 14.50.28@2x.png
Coury Clark:palm_tree: 3 months ago
can you real quick select \* from series_points
Chris Wendt  3 months ago
Maybe EOF means that the DB is in the middle of starting?
Chris Wendt  3 months ago
There's no series_points table
Coury Clark:palm_tree: 3 months ago
hmm
Coury Clark:palm_tree: 3 months ago
thats definitely possible, but not something I've ever encountered
Chris Wendt  3 months ago
Ah that was the problem
Coury Clark:palm_tree: 3 months ago
maybe because it was the first time
Coury Clark:palm_tree: 3 months ago
maybe the Timescale extension does something on startup for the first time
Chris Wendt  3 months ago
It works when I: Run sg run codeinsights-db in the background Delete codeinsights-db from the enterprise-codeinsights key in sg.config.yaml Run sg start enterprise-codeinsights
:+1:1
Coury Clark:palm_tree: 3 months ago
after it starts once, I wonder if you add it back to enterprise-codeinsights and try sg start enterprise-codeinsights?
Chris Wendt  3 months ago
Yep, now it's happy
Coury Clark:palm_tree: 3 months ago
interesting, good to know
Coury Clark:palm_tree: 3 months ago
I'd be timescale is slow to start on its first go
