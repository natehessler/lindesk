-   Application engineer: Stomzy Mwendwa
-   Customer: Avito 
-   Date: Feb 2
-   Version: â€‹
-   Deployment:
-   External Services:
-   Auth Providers:
-   Slack Links: https://sourcegraph.slack.com/archives/C02VC14H5EU/p1643878381476219
-   GitHub Issue Link:
-   Doc Update Link:
The customer set up access to repos but the repositories couldn't be cloned and there were error logs: t=2022-02-03T08:50:26+0000 lvl=eror msg=CommitIndexer.GetCommits error="git command \[git log --format=format:%H%x00%x00%aN%x00%aE%x00%at%x00%cN%x00%cE%x00%ct%x00%B%x00%P%x00 --after=2021-02-02T09:38:21Z --date-order\] failed (output: \"\"): context deadline exceeded" count=1.000 elapsed=44.999
Customer also asked if there's an option to the number of connections to pgsql?
This error was visible on cse-k8s a few versions ago. The customer reported that pgbouncer increased the connection limit to 100 after receiving the error and started cloning the repos. Issue fixed itself.
The answer to the customer's question is that this would be achievable by providing a custom config for max_connections.
You'd be able to specify the maximum number of open connections from the application to the database using the SRC_PGSQL_MAX_OPEN env var(from this doc). The logic behind it, here.The env var would be setup in the following services(that talk to the database): frontend gitserver repo-update precise-code-intel-worker worker
This resolved itself.
