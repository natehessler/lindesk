-   Application engineer: Stomzy Mwendwa
-   Customer: Unity 
-   Date: June 7, 2022
-   Version: 3.36.2â€‹
-   Deployment: kubernetes
-   External Services: GITHUB,GITLAB
-   Auth Providers: builtin,saml
-   Slack Links: https://sourcegraph.slack.com/archives/C01FKCMAVH9/p1654602856582299
-   GitHub Issue Link: N/A
-   Doc Update Link: N/A
Hi sourcegraph people wave. We are troubleshooting some problem cases and we see one particular pod maxing out on CPU on a \~30 minute interval (see screenshot). The pod's logs do not have much information other than some repos being inaccessible due to lack of permissions or not found (which really doesn't look like a big deal) but we also see occasional log entries with the following: t=2022-06-07T11:20:30+0000 lvl=eror msg="error running cleanup command" name="sg maintenance" repo=/data/repos/github.com/unity-technologies/comet/.git error="failed to run sg maintenance: /bin/sh sh failed with stderr: : exit status 128"
I seem to have managed to fix the CPU spike btw so I my assumption about sg maintenance must have been wrong (I excluded a problematic repo that has lots of big blobs)
Oh that makes sense. Thanks for spotting that. The bigger the repos the more this occurs. This was however fixed in v3.39 so whenever you get to upgrading, you should see less of this. Also an additional note that it's key to ensure that you have either sg maintenance or git gc enabled for your repos, just to avoid this happening again. Theres a strong preference to keeping sg maintenance due to it's far better cleanup routine over git gc. For this you could add git config gc.auto 0 in your larger repos/monorepos git configs.
