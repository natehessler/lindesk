zendeskTicketNumber: 7082
zendeskLink: https://sourcegraph.zendesk.com/agent/tickets/7082
title: docker compose out of date
Application engineer: Jason Harris
Customer: AppFolio 
Date: Mar 22
Version: â€‹3.38
Deployment: docker-compose
External Services:
Auth Providers:
Slack Links: https://sourcegraph.slack.com/archives/C02JCB0TM26/p1647966841085519
GitHub Issue Link:
Doc Update Link: https://github.com/sourcegraph/sourcegraph/pull/32959
Summary: Customer attempting to upgrade from 3.37 to 3.38 was unexpectedly greeted with the following error:
ERROR: The Compose file './docker-compose.yaml' is invalid because: services.sourcegraph-frontend-internal.depends_on.migrator.condition contains "service_completed_successfully", which is an invalid type, it should be a service_started, or a service_healthy
After asking about all the usual suspects, I sought help in the customer-support-internal channel. Warren informed me that their docker-compose version was out of date, which is why the service_completed_successfully dependency condition wasn't being registered.
Customer upgraded docker-compose to 3.29, this fixed the issue
https://github.com/sourcegraph/sourcegraph/pull/32959
