zendeskTicketNumber: 4393
zendeskLink: https://sourcegraph.zendesk.com/agent/tickets/4393
title: Fiverr upgrade issue
Application engineer: Stomzy Mwendwa
Customer: Fiverr, Ltd. 
Date: Nov 2
Version: 3.30.3​
Deployment: kubernetes
External Services: GITHUB
Auth Providers: github
Slack Links: https://sourcegraph.slack.com/archives/C01FG5LUWUU/p1635855121005200
GitHub Issue Link: https://github.com/sourcegraph/customer/issues/550
Doc Update Link:
Summary: The customer reported errors related to codeintel-db not being able to find a relation to schema_migratons. What was funny is that this table doesn't belong in the code intel db.
Exec into pgsql and codeintel_db Checked for dirty migrations Checked for db corruption Hopped onto a call to debug further and looked at logs
Turns out that this is an issue related to the customer using a dirty upgrade/deployment. In this case, the customer didn't use the standard practices of forking our deployment repo and fetching changes upstream. They have to do this manually and only grab the image tags and hence miss out on newly added lines on the manifest. Advised the customer to re-deploy Sourcegraph correctly for this purpose.
