zendeskTicketNumber: 5654
zendeskLink: https://sourcegraph.zendesk.com/agent/tickets/5654
title: renamed repo causing issues in batch changes
Application engineer: Kelvin Lee
Customer: Redfin 
Date: Jan 18
Version: 3.35.1â€‹
Deployment: docker-container
External Services: BITBUCKETSERVER
Auth Providers: builtin
Slack Links: [Slack with customer](https://sourcegraph.slack.com/archives/C01MRQQ9YQP/p1642551160001700), [Slack requesting help](https://sourcegraph.slack.com/archives/C01JR51JR5J/p1642622811150700), and a [in-the-future retro'ish look on this issue](https://sourcegraph.slack.com/archives/C01JR51JR5J/p1642795247301800?thread_ts=1642792459.299300&cid=C01JR51JR5J)
GitHub Issue Link: [GitHub Issue](https://github.com/sourcegraph/customer/issues/652)
Doc Update Link: None
Summary: Batch changes failing due to a renamed repo not behaving. (Keywords: rename, old repo, new repo, path changes, batch changes (but honestly effects any other part of the product that references the repo))
Attempted two known workarounds: - Apply the 
> Here goes. The general idea is: I've fixed this in the past by adding the previous repo name to the code host exclusion list, waiting for it to be deleted, and then removing it from the exclusion list.Â (removing it again from the exclusion list isnt necessary, but it keeps the configuration cleaner)
>
> The steps to conduct the above look something like this: Please navigate toÂ Site Admin -\> Manage Code Hosts -\> (Select your code host)In the configuration JSON file, please add the following repo exclusion:
    "exclude": [
     Â Â Â {
     Â Â Â Â Â "name": "
     Â Â Â }
     Â ],
> After a few minutes, Sourcegraph should remove the repo from your instance, and prevent it from being rediscovered which should resolve the issue.You can confirm this deletion is done by navigating to: Site Admin -\> Repository StatusÂ and searching for the repository by name.If the repository does not appear, then it has been completely removed from your instance, and your batch change should resolve without error.
>
> This will require that you have site-admin access. Would you like to look this over and give it a shot? And of course, let me know if you have any questions or problems. I'll be working in parallel here to understand this as well.
Neither workaround worked ðŸ¤£
There's a code fix for it, [here](https://github.com/sourcegraph/zoekt/pull/244). I shared a specific commit to the customer, but it is captured in the PR linked.
    Error:
      resolving repositories: resolving "context:global pipeline_template = 'libraryworkflow' file:pipeline_config.groovyÂ -file:\"{{ cookiecutter*\}}" -
     Â  * {
     Â Â "message": "repository does not exist: 
     Â Â "path": [
     Â Â Â "search",
     Â Â Â "results",
     Â Â Â "results",
     Â Â Â 21,
     Â Â Â "repository",
     Â Â Â "defaultBranch"
     Â Â ]
     Â }
    "repository does not exist"
