zendeskTicketNumber: 5557
zendeskLink: https://sourcegraph.zendesk.com/agent/tickets/5557
title: New Slack message in support-citrix
Application engineer: Stomzy Mwendwa
Customer: Citrix 
Date: Jan 13
Version: 3.35.1â€‹
Deployment: docker-compose
External Services: BITBUCKETSERVER
Auth Providers: saml
Slack Links: https://sourcegraph.slack.com/archives/CT9P97S6L/p1642075424000700
GitHub Issue Link:
Doc Update Link:
Summary: The customer would like to know if there is an ability to create a token for a user using the GraphQL API. mutation { createAccessToken(204: ID!) { user: 204, scopes: "site-admin:sudo", note: "Sourcegraph License Cleanup - secretid: 28205" } }
We tried the following query: mutation CreateAccessToken(\$user: ID, \$scopes: \[String!\]!, \$note: String!) { createAccessToken(user: 204, scopes: "site-admin:sudo", note: "Sourcegraph License Cleanup") { token id } }
Upon further investigation, based on: https://sourcegraph.com/github.com/sourcegraph/sourcegraph/-/blob/cmd/frontend/graphqlbackend/access_tokens.go?L40-47 this was disabled to prevent site admins from accessing users private code.
The workaround with this I offered to enable builtin auth, setup credentials as an admin for the service account and log in as the service account and generate the token.
https://sourcegraph.com/github.com/sourcegraph/sourcegraph/-/blob/cmd/frontend/graphqlbackend/access_tokens.go?L40-47
