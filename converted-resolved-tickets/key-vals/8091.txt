zendeskTicketNumber: 8091
zendeskLink: https://sourcegraph.zendesk.com/agent/tickets/8091
title: Batch changes slow on MacOS vs Linux
Application engineer: Gabe Torres
Customer: Reddit 
Date: May 9
Version: 3.36.2​
Deployment: kubernetes
External Services: GITHUB
Auth Providers: builtin,github
Slack Links: https://sourcegraph.slack.com/archives/C02BJ8T258D/p1652138637628119
GitHub Issue Link: https://github.com/sourcegraph/customer/issues/931
Doc Update Link:
Summary: Running the batch change on Mac OS is SLOW. Regardless of whether I run aarch64 or amd64, it's slow. It takes less than a second to run all of my commands and tools locally, but it routinely takes 2-5 minutes for them to run as part of the src batch. I just tried it out on Linux. More than 4x faster.  40min down to 10min, and I might be able to go a lot faster with more parallelism.
It looks like the slowness on Mac is caused by Docker filesystem operations. Docker for Mac uses a Linux VM to perform Docker operations and if the VM needs to access the file system, it has to RPC an endpoint on the host to perform the fs operation on the hosts fs. Docker has an experimental file sharing implementation called virtiofs which should improve file sharing performance. Also, when server side batch changes are released, they will run on Linux so this will be faster.
