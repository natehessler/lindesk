zendeskTicketNumber: 6066
zendeskLink: https://sourcegraph.zendesk.com/agent/tickets/6066
title: New Slack message in trial-toast-sourcegraph
Application engineer: Giselle Northy
Customer: Toast 
Date: Feb 7
Version: 3.30.0​
Deployment: docker-container
External Services: GITHUB
Auth Providers: builtin,github
Slack Links:
GitHub Issue Link:
Doc Update Link:
Summary: We're trying to update from 3.30 -\> 3.31, and reading over the instructions for that upgrade, I'm not sure what to do. Specifically this bit: \> If your indexes are corrupted, then there is also a possibility that there is bad data in your databases that would cause the re-indexing process (and thus the 3.31.x upgrade) to fail. In order to do a first-pass check for corrupt indexes, please run the following SQL query against both of the following instances before upgrading to 3.31.x:
The queries pointed only to docker-compose. He needed the query for single.
THESE QUERIES ARE FOR SINGLE DOCKER CONTAINER
I confirmed that you'll want to run the check script before upgrading on both the sourcegraph and sourcegraph-codeinteldbs. Those are the equivalent to these in the docs - their name is a little different:
pgsql codeintel-db
To get there I got the container  image id from docker ps Then put in the container ID. Run the aforementioned queries for each DB and check the output.
DOC UPDATE HERE https://github.com/sourcegraph/sourcegraph/pull/30921
