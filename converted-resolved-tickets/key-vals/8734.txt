zendeskTicketNumber: 8734
zendeskLink: https://sourcegraph.zendesk.com/agent/tickets/8734
title: shipt - help write comby batch change
Application engineer: Warren Gifford
Customer: Target 
Date: June 3, 2022
Version: 3.24.1â€‹
Deployment: kubernetes
External Services: GITHUB
Auth Providers: builtin,openidconnect
Slack Links:
GitHub Issue Link:
Doc Update Link:
Summary: I'm trying to add some required alpine packages in Dockerfiles across all our repos. Here is what I've hacked together via comby so far: comby -matcher .sh -in-place 'apk:\[opts\]add :\[paks\~.*(?!gcc).*\]' 'apk:\[opts\]add :\[paks\] gcc' Dockerfile comby -matcher .sh -in-place 'apk:\[opts\]add :\[paks\~.*(?!g++).*\]' 'apk:\[opts\]add :\[paks\] g++' Dockerfile
Basically, if a line in Dockerfile contains apk add (potentially with options between the two keywords) and is missing the gcc package, I want to add it at the end. Same for g++. This kinda does what I intended, except it's also adding those packages to a second image declared in same Dockerfile but it does not require the compilers, so I have a new requirement that the apk add line I want to modify must already contain the git or make package, so I can infer that is the image that will be used for building the code. Question is, how would I modify the above commands to accomplish this? Is there a cleaner way to do this?
Customer answered themselves
comby -matcher .sh -in-place 'apk:\[opts\]add :\[paks\~.*(?=make\
