zendeskTicketNumber: 5872
zendeskLink: https://sourcegraph.zendesk.com/agent/tickets/5872
title: repo errors on src batch preview are ignored in support-unity-users
Application engineer: Mariam Adedeji
Customer: Unity 
Date: Jan 28
Version: 3.36.2​
Deployment: kubernetes
External Services: GITHUB,GITLAB
Auth Providers: builtin,saml
Slack Links: https://sourcegraph.slack.com/archives/C01FXGSJW5R/p1643371520052200
GitHub Issue Link:
Doc Update Link:
Summary: After properly looking through the case, we were able to discover that this was happening because some repos were failing but there were no errors printed out on src-cli to identify the cause. 
The customer dug deeper and discovered a bug in our codebase and went further to fix this and push for a pull request. I notified the batch changes team of this request. The request was merged and they shipped a new patch release of src-cli as 3.36.2
I am unable to get Sourcegraph to consistently create changesets for a batch update When he runs a batch change spec, It runs to completion and finds some 290 repos and makes changes to most of them, but none of them show up in the query afterward and preview 0 changeset
The customer did most of the troubleshooting. He pulled the src-cli code to his laptop and debugged the code locally. He said he could see where it wasn't returning the results and saw it mentioned a -skip-errors flag in the code where it was returning that result. Looking in the code it does not seem to forward the actual errors all the way, so at the end it just silently returns exit code 1 and doesn't print the errors. So the only way to know if there's a problem is to look at this line: :white_check_mark: Executing... (291/291, 22 errored) But it does not print what those errored repositories are and what the error is. Then he discovered the bug, fix it and raised a pull request
The customer discovered a bug with src-cli, fix it and pushed for pull request. This was merged by the team internally and shipped the update src-cli to version 3.36.2
https://github.com/sourcegraph/src-cli/pull/686
Executing... (291/291, 22 errored)
