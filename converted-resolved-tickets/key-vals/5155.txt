zendeskTicketNumber: 5155
zendeskLink: https://sourcegraph.zendesk.com/agent/tickets/5155
title: Repos not cloning
Application engineer: Gabe Torres
Customer: Capital One 
Date: Dec 15
Version: 3.31
Deployment: ECS
External Services:
Auth Providers:
Slack Links: https://sourcegraph.slack.com/archives/C01QNMSLTFZ/p1639607711076500
GitHub Issue Link:
Doc Update Link:
Summary: The customer reported that none of their repos were cloning. Their repos were showing "Repository does not exist" and they were stuck under "Not cloned".
The customer saw "repository does not exist" errors in the worker logs. These errors are expected on their empty or archived repos so this error was a misleading clue. We cloned a repo inside of their gitserver container to make sure there was no issues communicating with GitHub. The code host config did not show any errors so it seemed to be correct. We checked the grafana dash for repo updater and we saw a lot of repos stalling. "Rate of growth of update queue length over 5 minutes" showed that there was a backup of repos in the queue. The "remaining API calls to GitHub" graph also showed that they were running out of API calls but they were using a new token. The admin set the log level to debug SRC_LOG_LEVEL=dbug. This showed the following error in repo-updater "not cloning on demand as DisableAutoGitUpdates is set"
We found out that the admin had copied their site config from another instance where they were restricting communication to GitHub by using
    "disableAutoGitUpdates": true,
    "disableAutoCodeHostSyncs": true,
    "gitMaxCodehostRequestsPerSecond": 0,
After removing these settings they were able to see the repos cloning.
